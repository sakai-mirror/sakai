<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="false">

   <bean id="idManager" class="org.sakaiproject.metaobj.shared.mgt.IdManagerImpl">
   </bean>

	<bean id="authManager" class="org.sakaiproject.metaobj.security.impl.sakai.AuthnManager">
      <property name="ospiIdManager"><ref bean="idManager"/></property>
   </bean>

   <bean id="agentManager" class="org.sakaiproject.metaobj.security.impl.sakai.AgentManager">
       <property name="ospiIdManager"><ref bean="idManager"/></property>
   </bean>

   <bean id="sessionFactory"
      parent="org.sakaiproject.springframework.orm.hibernate.SessionFactoryBase">
      <property name="mappingResources">
         <list>
	    		<value>org/sakaiproject/metaobj/security/impl/simple/AuthorizationImpl.hbm.xml</value>
            <value>org/sakaiproject/metaobj/shared/mgt/StructuredArtifactDefinition.hbm.xml</value>
         </list>
		</property>
   </bean>

   <!--bean id="explicitAuthz" class="org.sakaiproject.metaobj.security.impl.sakai.WorksiteAwareAuthorizationFacade" >
      <property name="sessionFactory"><ref bean="sessionFactory"/></property>
      <property name="authManager"><ref bean="authManager"/></property>
      <property name="agentManager"><ref bean="agentManager"/></property>
      <property name="sakaiSecurityBase">
         <bean id="org.sakaiproject.metaobj.security.impl.sakai.SecurityBase"
            class="org.sakaiproject.metaobj.security.impl.sakai.SecurityBase">
            <property name="ospiIdManager"><ref bean="idManager"/></property>
         </bean>
      </property>
   </bean>

   <bean id="worksiteAuthz" class="org.sakaiproject.metaobj.security.impl.sakai.WorksiteAuthorizer">
      <property name="functions">
         <list>
            <bean id="org.sakaiproject.metaobj.worksite.mgt.WorksiteManager.WORKSITE_MAINTAIN"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField"><value>org.sakaiproject.metaobj.worksite.mgt.WorksiteManager.WORKSITE_MAINTAIN</value></property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="authzManager" class="org.sakaiproject.metaobj.security.app.AuthorizationFacadeImpl" >
      <property name="authManager"><ref bean="authManager"/></property>
      <property name="explicitAuthz"><ref bean="explicitAuthz"/></property>
      <property name="applicationAuthorizers">
         <list>
            <ref bean="worksiteAuthz"/>
         </list>
      </property>
   </bean-->

   <bean id="authzManager" class="org.sakaiproject.metaobj.security.impl.AuthzShim" />
   
   <bean id="fileArtifactFinder" class="org.sakaiproject.metaobj.repository.mgt.impl.FileArtifactFinderImpl">
      <property name="homeFactory"><ref bean="homeFactory" /></property>
      <property name="sessionFactory"><ref bean="sessionFactory"/></property>
   </bean>

   <bean id="artifactFinder" class="org.sakaiproject.metaobj.repository.mgt.impl.ArtifactFinderImpl">
      <property name="homeFactory"><ref bean="homeFactory" /></property>
      <property name="sessionFactory"><ref bean="sessionFactory"/></property>
   </bean>

   <bean id="artifactFinderManager" class="org.sakaiproject.metaobj.shared.mgt.ArtifactFinderManager">
      <property name="finders">
         <map>
            <entry key="fileArtifact"><ref bean="fileArtifactFinder"/></entry>
         </map>
      </property>
      <!-- default finder, if can't find a finder in the finder list this one is used -->
      <property name="artifactFinder"><ref bean="artifactFinder"/></property>

   </bean>

     <bean id="org.sakaiproject.metaobj.worksite.mgt.WorksiteManager"
         class="org.sakaiproject.metaobj.worksite.mgt.impl.WorksiteManagerImpl">
      <property name="idManager"><ref bean="idManager"/></property>
   </bean>

   <bean id="sadTransactionManager"
      class="org.springframework.orm.hibernate.HibernateTransactionManager">
      <property name="sessionFactory">
         <ref
            bean="sessionFactory" />
      </property>
   </bean>

   <bean id="structuredArtifactDefinitionManagerTarget"
      class="org.sakaiproject.metaobj.shared.mgt.impl.StructuredArtifactDefinitionManagerImpl"
      singleton="true">
      <property name="sessionFactory"><ref bean="sessionFactory"/></property>
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="artifactFinderManager"><ref bean="artifactFinderManager"/></property>
      <property name="authzManager"><ref bean="authzManager"/></property>
      <property name='worksiteManager'><ref bean="org.sakaiproject.metaobj.worksite.mgt.WorksiteManager"/></property>
      <property name="contentHosting"><ref bean="org.sakaiproject.service.legacy.content.ContentHostingService"/></property>
   </bean>

   <bean id="structuredArtifactDefinitionManager"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
      singleton="true">
      <property name="transactionManager">
        <ref bean="sadTransactionManager"/>
      </property>
      <property name="target">
         <ref bean="structuredArtifactDefinitionManagerTarget"/>
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">PROPAGATION_REQUIRED</prop>
         </props>
      </property>
   </bean>

   <bean id="dbXmlHomeFactory" class="org.sakaiproject.metaobj.shared.mgt.factories.DbXmlHomeFactoryImpl">
      <property name="structuredArtifactDefinitionManager"><ref bean="structuredArtifactDefinitionManager"/></property>
   </bean>

   <bean id="homeFactory" class="org.sakaiproject.metaobj.shared.mgt.HomeFactoryImpl">
      <property name="homeFactories">
         <list>
           <ref bean="dbXmlHomeFactory"/>
         </list>
      </property>
   </bean>

    <bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
       <property name="locations">
          <list>
             <value>classpath:hibernate.properties</value>
             <value>classpath:system.properties</value>
          </list>
       </property>
    </bean>
    
   <bean id="ospConfig" class="org.sakaiproject.metaobj.utils.Config">
      <property name="properties">
         <props>
            <!-- todo prop key="baseUrl">${system.baseUrl}</prop-->
            <prop key="baseUrl">http://localhost:8080</prop>
            <prop key="allowGuests">true</prop>
            <prop key="institutionName">OSP</prop>
            <prop key="institutionFullName">Open Source Portfolio</prop>
         </props>
      </property>
   </bean>

   <bean id="beanFactory" class="org.sakaiproject.metaobj.utils.BeanFactory">
   </bean>

   <bean id="fieldValueWrapperFactory" class="org.sakaiproject.metaobj.shared.mgt.factories.FieldValueWrapperFactoryImpl" >
      <property name="wrappedClassNamesMap">
         <props>
            <prop key="java.util.Date">org.sakaiproject.metaobj.shared.model.DateBean</prop>
         </props>
      </property>
   </bean>

   <bean id="org.sakaiproject.metaobj.shared.mgt.PortalParamManager"
         class="org.sakaiproject.metaobj.shared.mgt.impl.PortalParamManagerImpl" >

      <property name="parameters">
         <list>
            <value>pid</value>
            <value>panelId</value>
         </list>
      </property>

   </bean>

    <!--bean id="autoProxyCreator"
        class="org.sakaiproject.metaobj.utils.aop.AdvisorBeanNameAutoProxyCreator">
      <property name="interceptorNames">
        <list>
          <idref local="matchNameTxInterceptor"/>
        </list>
      </property>
      <property name="beanNames">
        <list>
           <value>structuredArtifactDefinitionManager</value>
          <value>authManager</value>
          <value>authzManager</value>
          <value>agentManager</value>
           <value>imageXmlHome</value>
           <value>unknownFileTypeXmlHome</value>
           <value>folderXmlHome</value>
          <value>fileArtifactHome</value>
          <value>homeFactory</value>
          <value>org.sakaiproject.metaobj.repository.intf.NodeTreeService</value>
          <value>org.sakaiproject.metaobj.repository.intf.NodeMetadataService</value>
          <value>org.sakaiproject.metaobj.repository.intf.StreamStore</value>
          <value>wck</value>
          <value>lockManager</value>
          <value>repositoryManager</value>
          <value>quotaDao</value>
          <value>idManager</value>
          <value>fileArtifactFinder</value>
          <value>artifactFinder</value>
          <value>artifactFinderManager</value>
          <value>org.sakaiproject.metaobj.shared.mgt.PortalParamManager</value>
          <value>org.sakaiproject.metaobj.worksite.mgt.WorksiteManager</value>
        </list>
      </property>
    </bean-->

</beans>