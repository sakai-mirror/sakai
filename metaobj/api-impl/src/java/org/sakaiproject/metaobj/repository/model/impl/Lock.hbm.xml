<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 2.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">
<hibernate-mapping
   package="org.sakaiproject.metaobj.repository.model">

   <class name="Lock" table="osp_repository_lock" lazy="true" batch-size="10">
      <cache usage="nonstrict-read-write"/>

      <id name="id" column="id" length="32" type="org.sakaiproject.metaobj.shared.IdType">
         <generator class="org.sakaiproject.metaobj.shared.IdGenerator"/>
      </id>

<!--
      <id name="id" length="40" type="long">
         <generator class="native">
            <param name="sequence">osp_RepositoryLock_SEQ</param>
            </generator>
      </id>
-->

      <property name="asset" length="32" type="org.sakaiproject.metaobj.shared.IdType">
      	<column name="asset_id" not-null="false" index="osp_Lock_assetId_isActive_IDX"/>
      </property>
      <property name="qualifier" length="32" column="qualifier_id" not-null="false"
      	type="org.sakaiproject.metaobj.shared.IdType"/>
      <property name="active" type="boolean">
			<column name="is_active" not-null="false" index="osp_Lock_assetId_isActive_IDX"/>
      </property>
      <property name="reason" length="255" column="reason" not-null="false"/>
      <property name="dateAdded" column="date_added" not-null="false"/>
      <property name="dateRemoved" column="date_removed" not-null="false"/>
      
   </class>

   <query name="activeByAsset">
      from Lock w where is_active=1 and asset_id=?
   </query>

   <query name="getLock">
      from Lock w where asset_id=? and qualifier_id=?
   </query>

   <query name="getQualifierLocks">
      from Lock w where qualifier_id=?
   </query>

   <query name="getChildrenLocks">
      from Lock lock, TreeNode tree where lock.asset = tree.nodeId and lock.active=1 and tree.uri like ?
   </query>

</hibernate-mapping>
