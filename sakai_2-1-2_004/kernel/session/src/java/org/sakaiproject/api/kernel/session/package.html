<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta name=Title content="Sakai Sessions">
<meta name=Keywords content="">
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="package_files/filelist.xml">
<title>Sakai Sessions</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Glenn Golden</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>Glenn Golden</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:Created>2005-03-07T18:27:00Z</o:Created>
  <o:LastSaved>2005-03-07T18:27:00Z</o:LastSaved>
  <o:Pages>2</o:Pages>
  <o:Words>763</o:Words>
  <o:Characters>4351</o:Characters>
  <o:Company>University of Michigan</o:Company>
  <o:Lines>36</o:Lines>
  <o:Paragraphs>8</o:Paragraphs>
  <o:CharactersWithSpaces>5343</o:CharactersWithSpaces>
  <o:Version>10.260</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>BestFit</w:Zoom>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:"Courier New";
	panose-1:0 2 7 3 9 2 2 5 2 4;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:50331648 0 0 0 1 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:Times;}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Helvetica;
	mso-font-kerning:16.0pt;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Helvetica;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
</head>

<body bgcolor=white lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<h1 align=center style='text-align:center'>Sakai Sessions</h1>

<p class=MsoNormal align=center style='text-align:center'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal align=center style='text-align:center'>$Revision: 1.2 $</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Sakai differs from other single web applications in that it
is deployed over a number of separate web applications in a Servlet
container.<span style="mso-spacerun: yes">&nbsp; </span>While the Servlet API
defines capabilities for user session information within each web application,
it does not define a user session capability across all web applications.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Sakai’s Session API provides this Sakai-wide session
capability.<span style="mso-spacerun: yes">&nbsp; </span>Modeled on the
HttpSession of the Servlet 2.4 Spec, a Sakai session is scoped at the end user
level and shared among all Sakai applications, each in a different webapps, and
the Sakai framework.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The interfaces in the Session API (Session,
SessionBindingListener, SessionBindingEvent) are closely modeled on the similar
interfaces in the Servlet API (HttpSession, HttpSessionBindingListener,
HttpSessionBindingEvent), but do not directly extend these Servlet APIs.<span
style="mso-spacerun: yes">&nbsp; </span>We make them similar because they do
similar things, and so that developers can leverage their understanding of the
Servlet API when working with Sakai.<span style="mso-spacerun: yes">&nbsp;
</span>We keep them from directly extending to keep the Sakai Session API code
independent of the Servlet API.</p>

<h3>Sakai Sessions</h3>

<p class=MsoNormal>A Sakai session is just like an HttpSession from the Servlet
2.4 API, without the deprecated methods, and with some other minor changes
(such as the use of an Iterator instead of an Enumeration for <span
style='font-family:"Courier New"'>getAttributeNames()</span>).</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Like the HttpSession, a Sakai session can hold attributes,
and expires after a period of time unless refreshed by a client request to any
Sakai web application.<span style="mso-spacerun: yes">&nbsp; </span>Values used
in session attributes can implement the SessionBindingListener interface and be
informed when they are bound or unbound from a Session.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Sakai sessions also store the user id of the authenticated
end user as a first-class property.</p>

<h3>Session Manager</h3>

<p class=MsoNormal>The SessionManager manages Sakai sessions.<span
style="mso-spacerun: yes">&nbsp; </span>The APIs for sessions are defined in
the Sakai <span style='font-family:"Courier New"'>kernel</span> module, in the <span
style='font-family:"Courier New"'>session</span> project.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The SessionManager is responsible for the creation of
Sessions, and is used to find sessions based on either the session id or the
authenticated user id.</p>

<h3>Current Session</h3>

<p class=MsoNormal>The Session API supports the idea of a “current”
session.<span style="mso-spacerun: yes">&nbsp; </span>This is the Session
object associated with the end user behind the current request processing thread.<span
style="mso-spacerun: yes">&nbsp; </span>Any Sakai code can ask the
SessionManager for the current session via the <span style='font-family:"Courier New"'>getCurrentSession()</span>
method.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The current session capability is implemented using the
Sakai Framework’s CurrentManager.<span style="mso-spacerun: yes">&nbsp;
</span>The Sakai Request Filter handles the setup that makes this possible.</p>

<h3>Sessions in a Web Server Environment</h3>

<p class=MsoNormal>When Sakai is running in a web server environment, the
Servlet container manages each webapp’s HttpSession, usually using a cookie
called <span style='font-family:"Courier New"'>JSESSIONID</span>, written by
the container to the end user’s browser.<span style="mso-spacerun: yes">&nbsp;
</span>There is a separate cookie for each web application.<span
style="mso-spacerun: yes">&nbsp; </span>The browse sends the appropriate cookie
with each request to each webapp.<span style="mso-spacerun: yes">&nbsp;
</span>The Servlet API has no provision to manage a global session.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The Sakai Session is managed in a similar way.<span
style="mso-spacerun: yes">&nbsp; </span>Sakai sends a single cookie called <span
style='font-family:"Courier New"'>SakaiSessionId</span> to the end user’s
browser, target at the root of the Sakai web server.<span style="mso-spacerun:
yes">&nbsp; </span>The browser sends this one cookie back to any request to
Sakai.<span style="mso-spacerun: yes">&nbsp; </span>Each webapp installed in
Sakai sees the cookie and has the end user’s session id available when
processing requests.</p>

<h3>Sakai Request Filter</h3>

<p class=MsoNormal>Sakai makes available a Servlet Filter that pre-processes
all requests to Sakai tools.<span style="mso-spacerun: yes">&nbsp; </span>One
thing this filter does is manages the session cookie.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The filter looks for the cookie on each request.<span
style="mso-spacerun: yes">&nbsp; </span>When found, it asks the SessionManager
to locate the valid active Session identified by the session id in the
cookie.<span style="mso-spacerun: yes">&nbsp; </span>This session is placed in
a request attribute, <span style='font-family:"Courier New"'>sakai.session</span>,
for later use by the Sakai tool processing the request.<span
style="mso-spacerun: yes">&nbsp; </span>The authenticated user id of the
session is set as the request’s remote user.<span style="mso-spacerun:
yes">&nbsp; </span>This allows applications that are not Sakai aware to share
the “single sign-on” made possible with the Sakai session, and to know the id
of the end user for the request.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The filter also sets up the CurrentManager for the request
processing thread, and sets the session found to be the “current” session that
will be returned by anyone calling <span style='font-family:"Courier New"'>getCurrentSession().</span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The request filter makes sure that the cookie is set while
the session is active, and that the cookie is removed when the session ends.</p>

<h3>Use of the Session</h3>

<p class=MsoNormal>The Sakai Framework uses the session to store the
authenticated end user id.<span style="mso-spacerun: yes">&nbsp; </span>It may
store other Sakai-wide per-user information there as well.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Sakai applications can also use the session to store
per-user session information.<span style="mso-spacerun: yes">&nbsp;
</span>Applications need to establish a namespace that separates their
information from other Sakai applications, and separates one placement of an
application from all other placements.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>The Sakai framework uses attribute names beginning with
“sakai.” for framework-scoped information.</p>

<h3>Session API Implementation</h3>

<p class=MsoNormal>Sakai ships with a standard component that implements the
Session API.<span style="mso-spacerun: yes">&nbsp; </span>This is in the <span
style='font-family:"Courier New"'>kernel</span> module’s <span
style='font-family:"Courier New"'>session-component</span> project.<span
style="mso-spacerun: yes">&nbsp; </span>It is deployed as part of the <span
style='font-family:"Courier New"'>kernel</span> module’s <span
style='font-family:"Courier New"'>kernel-components</span> project. It is
unlikely that any Sakai installation would want to swap this out for another
implementation, but this is possible.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

</div>

</body>

</html>
