<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<!-- Logger for RWiki  -->
	<bean id="rwiki-logger"
		parent="org.sakaiproject.service.framework.log.Logger">
		
	</bean>
	
	<!-- each transaction manager, and therefore session factory must have its own data source,
	so overload here to avoid getting the central one -->
	<bean id="sakai-rwiki.javax.sql.DataSource" parent="javax.sql.DataSource">
	</bean>
	
	<!-- extend the  sakai base session factory -->
	<!--
	class="org.springframework.orm.hibernate.LocalSessionFactoryBean"
	-->
	<bean id="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"
		parent="org.sakaiproject.springframework.orm.hibernate.SessionFactoryBase">
		
		<property name="dataSource">
			<ref local="sakai-rwiki.javax.sql.DataSource"/>
		</property>
		<property name="mappingResources">
			<list>
				<value>
					uk/ac/cam/caret/sakai/rwiki/model/impl/RWiki.hbm.xml</value>
			</list>
		</property>
	</bean>
	
	<!-- START NEW STUFF -->
	<!-- Register the Data Access Object as a Transactional Interceptor -->
	<bean id="rwikiCurrentObjectDao"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager"><ref
				bean="uk.ac.cam.caret.sakai.rwiki.RWikiTransactionManager"/>
			</property>
		<property name="transactionAttributes">
			<props>
				<!--
  				<prop key="exists">PROPAGATION_REQUIRED,readOnly</prop>
				<prop key="find*">PROPAGATION_REQUIRED,readOnly</prop>
				-->
				<prop key="update*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<!--. not needed for this version of create .-->
				<!--<prop key="create*">PROPAGATION_REQUIRED</prop>-->
			</props>
		</property>
		<property name="target"><ref bean="rwikiCurrentObjectDaoImpl"/></property>
	</bean>
	<!-- DAO for current Object, acessed via Transaction Proxy -->
	<bean id="rwikiCurrentObjectDaoImpl"
		class="uk.ac.cam.caret.sakai.rwiki.dao.impl.RWikiCurrentObjectDaoImpl"
		singleton="true">
		<property name="sessionFactory"><ref
				bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
			</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="contentDAO"><ref bean="rwikiCurrentObjectContentDaoImpl" /></property>
		<property name="historyDAO"><ref bean="rwikiHistoryObjectDaoImpl" /></property>		
	</bean>
	
	<!-- DAO for Current Object Content -->
	<bean id="rwikiCurrentObjectContentDaoImpl"
		class="uk.ac.cam.caret.sakai.rwiki.dao.impl.RWikiCurrentObjectContentDaoImpl"
		singleton="true">
		<property name="sessionFactory"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
		</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
	</bean>
	
	<!-- Transaction Proxy for the HistoryObject -->
	<bean id="rwikiHistoryObjectDao"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiTransactionManager"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<!--
					<prop key="exists">PROPAGATION_REQUIRED,readOnly</prop>
					<prop key="find*">PROPAGATION_REQUIRED,readOnly</prop>
				-->
				<prop key="update*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<!--. not needed for this version of create .-->
				<!--<prop key="create*">PROPAGATION_REQUIRED</prop>-->
			</props>
		</property>
		<property name="target"><ref bean="rwikiHistoryObjectDaoImpl"/></property>
	</bean>
	
	<!-- DAO for the History Object -->
	<bean id="rwikiHistoryObjectDaoImpl"
		class="uk.ac.cam.caret.sakai.rwiki.dao.impl.RWikiHistoryObjectDaoImpl"
		singleton="true">
		<property name="sessionFactory"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
		</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="contentDAO"><ref bean="rwikiHistoryObjectContentDaoImpl" /></property>
	</bean>
	
	<!-- Content DAO of the history object -->
	<bean id="rwikiHistoryObjectContentDaoImpl"
		class="uk.ac.cam.caret.sakai.rwiki.dao.impl.RWikiHistoryObjectContentDaoImpl"
		singleton="true">
		<property name="sessionFactory"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
		</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
	</bean>
	
	<!-- Render Factory for creating Wiki Renderer Contexts -->
	<bean id="renderContextFactory"
		class="uk.ac.cam.caret.sakai.rwiki.radeox.service.impl.RenderContextFactoryImpl">
		<property name="log"><ref bean="rwiki-logger"/></property>
		
		<property name="objectService"><ref bean="objectService"/></property>
		<property name="securityService"><ref bean="securityService"/></property>
	</bean>
	
	<!-- Wiki engine factory -->
	<bean id="renderEngineFactory"
		class="uk.ac.cam.caret.sakai.rwiki.radeox.service.impl.RenderEngineFactoryImpl">
		<property name="log"><ref bean="rwiki-logger"/></property>
		
		<property name="objectService"><ref bean="objectService"/></property>
		<property name="renderEngine"><ref bean="baseRenderEngine"/></property>
		<property name="externalImageLink"><value>&lt;img src="/library/image/sakai/url.gif" alt="external link: " title="external link"/&gt;</value></property>
	</bean>
	
	<!-- Service for creating commands in URL Processing -->
	<bean id="commandService"
		class="uk.ac.cam.caret.sakai.rwiki.service.impl.CommandServiceImpl">
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="commandMap">
			<map>
				<entry key="save"><ref bean="saveCommand"/></entry>
				<entry key="revert"><ref bean="revertCommand"/></entry>
				<entry key="updatePermissions"><ref bean="updatePermissionsCommand"/></entry>
				<entry key="editRealm"><ref bean="editRealmCommand"/></entry>
				<!--<entry key=""><ref bean="Command"/></entry>-->
			</map>
		</property>
	</bean>
	
	<!-- Page Population service -->
	<bean id="populateService"
		class="uk.ac.cam.caret.sakai.rwiki.service.impl.PopulateServiceImpl" 
		>
		
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="RWikiCurrentObjectDao"><ref bean="rwikiCurrentObjectDao"/></property>
		<property name="authz"><ref bean="org.sakaiproject.service.legacy.authzGroup.AuthzGroupService" /></property>
		<property name="seedPages">
			<!--
			You can add a list of seed pages here, that are loaded into each context where they
			are not found. For performance purposes this is only done once per runtime of the 
			web app.
			
			The easiest way of creating new pages for seed, it to use the Rwiki tool in sakai to 
			edit the page, and then cut and paste the markup here with the required properties, then 
			restart the webapp. The Name should be a local name, as it will be converted to a suitable
			global name when the page is injected into the site, and the realm or use should not be set
			as these will be overwritten when the page is injected.
			-->
			<list>
				<ref bean="rwiki.seedPage.HelpPage"/>
				<ref bean="rwiki.seedPage.HelpPagetwo"/>
				<ref bean="rwiki.seedPage.RecentChangesPage"/>
				<ref bean="rwiki.seedPage.EditRightPage"/>
				<ref bean="rwiki.seedPage.DefaultTemplate"/>
			</list>
		</property>
		<property name="roles">
			<list>
				<ref bean="rwiki.role.maintain" />
				<ref bean="rwiki.role.access" />
				<ref bean="rwiki.role.anon" />
			</list>
		</property>
	</bean>
	<bean id="rwiki.role.maintain" class="uk.ac.cam.caret.sakai.rwiki.service.impl.DefaultRoleImpl">
		<property name="roleId"><value>maintain</value></property>
		<property name="enabledFunctions">
			<map>
				<entry key="rwiki.create" ><value>true</value></entry>	
				<entry key="rwiki.read" ><value>true</value></entry>
				<entry key="rwiki.update" ><value>true</value></entry>
				<entry key="rwiki.delete" ><value>false</value></entry>
				<entry key="rwiki.superadmin" ><value>false</value></entry>
				<entry key="rwiki.admin" ><value>true</value></entry>
			</map>
		</property>
	</bean>
	<bean id="rwiki.role.access" class="uk.ac.cam.caret.sakai.rwiki.service.impl.DefaultRoleImpl">
		<property name="roleId"><value>access</value></property>
		<property name="enabledFunctions">
			<map>
				<entry key="rwiki.create"	><value>true</value></entry>	
				<entry key="rwiki.read" ><value>true</value></entry>
				<entry key="rwiki.update" ><value>true</value></entry>
				<entry key="rwiki.delete" ><value>false</value></entry>
				<entry key="rwiki.superadmin" ><value>false</value></entry>
				<entry key="rwiki.admin" ><value>false</value></entry>
			</map>
		</property>
	</bean>
	<bean id="rwiki.role.anon" class="uk.ac.cam.caret.sakai.rwiki.service.impl.DefaultRoleImpl">
		<property name="roleId"><value>.anon</value></property>
		<property name="enabledFunctions">
			<map>
				<entry key="rwiki.create"	><value>false</value></entry>
				<entry key="rwiki.read" ><value>true</value></entry>
				<entry key="rwiki.update" ><value>false</value></entry>
				<entry key="rwiki.delete" ><value>false</value></entry>
				<entry key="rwiki.superadmin" ><value>false</value></entry>
				<entry key="rwiki.admin" ><value>false</value></entry>
			</map>
		</property>
	</bean>
	
	<bean id="securityService"
		class="uk.ac.cam.caret.sakai.rwiki.service.impl.RWikiSecurityServiceImpl"
		 init-method="init" >
		<property name="log"><ref bean="rwiki-logger"/></property>
		
		<property name="portalService"><ref
				bean="org.sakaiproject.service.framework.portal.PortalService" />
			</property>
		<property name="securityService"><ref
				bean="org.sakaiproject.service.legacy.security.SecurityService"/>
			</property>
		<property name="siteService"><ref
				bean="org.sakaiproject.service.legacy.site.SiteService"/>
			</property>
	</bean>
	
	<bean id="renderService"
		class="uk.ac.cam.caret.sakai.rwiki.service.impl.RenderServiceImpl">
		<property name="log"><ref bean="rwiki-logger"/></property>
		
		<property name="renderContextFactory"><ref bean="renderContextFactory"/>
			</property>
		<property name="renderEngineFactory"><ref bean="renderEngineFactory"/>
			</property>
			<!-- comment the cache out to disable it -->
		<property name="renderCache"><ref bean="rwikiRenderCache"/></property>
	</bean>
	
	<bean id="objectService"
		class="uk.ac.cam.caret.sakai.rwiki.service.impl.RWikiObjectServiceImpl">
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="renderService"><ref bean="renderService"/></property>
		<property name="RWikiCurrentObjectDao"><ref bean="rwikiCurrentObjectDao"/></property>
		<property name="RWikiHistoryObjectDao"><ref bean="rwikiHistoryObjectDao"/></property>
		<property name="securityService"><ref bean="securityService"/></property>
	</bean>
	
	<bean id="uk.ac.cam.caret.sakai.rwiki.tool.RequestHelper"
		class="uk.ac.cam.caret.sakai.rwiki.tool.RequestHelper">
		<property name="log"><ref bean="rwiki-logger"/></property>
		
		<property name="commandService"><ref bean="commandService"/></property>
	</bean>
	
	<bean id="saveCommand"
		class="uk.ac.cam.caret.sakai.rwiki.command.SaveCommand">
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="noUpdatePath"><value>/WEB-INF/command-pages/permission.jsp</value>
			</property>
		<property name="contentChangedPath"><value>/WEB-INF/command-pages/edit.jsp</value>
			</property>
		<property name="successfulPath"><value>/WEB-INF/command-pages/view.jsp</value>
			</property>
		<property name="previewPath">
			<value>/WEB-INF/command-pages/edit.jsp</value></property>
		<property name="cancelPath">
			<value>/WEB-INF/command-pages/view.jsp</value></property>
		<property name="objectService"><ref bean="objectService"/></property>		
	</bean>
	<bean id="updatePermissionsCommand" class="uk.ac.cam.caret.sakai.rwiki.command.UpdatePermissionsCommand">
		<property name="noUpdatePath"><value>/WEB-INF/command-pages/permission.jsp</value></property>
		<property name="contentChangedPath"><value>/WEB-INF/command-pages/info.jsp</value></property>
		<property name="successfulPath"><value>/WEB-INF/command-pages/info.jsp</value></property>
		<property name="objectService"><ref bean="objectService"/></property>
	</bean>
	<bean id="revertCommand"
		class="uk.ac.cam.caret.sakai.rwiki.command.RevertCommand">
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="noUpdatePath"><value>/WEB-INF/command-pages/permission.jsp</value>
			</property>
		<property name="contentChangedPath"><value>/WEB-INF/command-pages/edit.jsp</value>
			</property>
		<property name="successfulPath"><value>/WEB-INF/command-pages/view.jsp</value>
			</property>
		<property name="objectService"><ref bean="objectService"/></property>
	</bean>
	<bean id="editRealmCommand"
		class="uk.ac.cam.caret.sakai.rwiki.command.EditAuthZGroupCommand">
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="realmService"><ref bean="org.sakaiproject.service.legacy.authzGroup.AuthzGroupService"/></property>
		<property name="cancelEditPath"><value>/WEB-INF/command-pages/info.jsp</value></property>
		<property name="editRealmPath"><value>/WEB-INF/command-pages/editRealm.jsp</value></property>
    	<property name="idInUsePath"><value>/WEB-INF/command-pages/realmIdInUse.jsp</value></property>
		<property name="permissionPath"><value>/WEB-INF/command-pages/permission.jsp</value></property>
		<property name="successfulPath"><value>/WEB-INF/command-pages/info.jsp</value></property>		
		<property name="unknownRealmPath"><value>/WEB-INF/command-pages/realmUnknown.jsp</value></property>		
	</bean>
	<!--<bean id="Command" class="uk.ac.cam.caret.sakai.rwiki.command.Command">
	<property name="log"><ref bean="rwiki-logger"/></property>
	<property name="servletPath">/jrwiki/.jsp</property>
	<property name="populateService"><ref bean="populateService"/></property>
	<property name="renderBeanHelper"><ref bean="renderBeanHelper"/></property>
	<property name="rwikiObjectHelper"><ref bean="rwikiObjectHelper"/></property>
	<property name="viewBeanHelper"><ref bean="viewBeanHelper"/></property>
	<property name="userHelper"><ref bean="userHelper"/></property>
	</bean>-->
	
	<!-- Transaction manager for a single Hibernate SessionFactory (alternative to JTA) -->
	<bean id="uk.ac.cam.caret.sakai.rwiki.RWikiTransactionManager"
		class="org.springframework.orm.hibernate.HibernateTransactionManager">
		<property name="sessionFactory"><ref
				bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
			</property>
	</bean>
	
	<bean id="rwiki.seedPage.HelpPage"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.RWikiCurrentObjectImpl"
		init-method="init" singleton="true">
		<property name="name"><value>Help Page</value></property>
		
		<property name="source">
			<value>/uk/ac/cam/caret/sakai/rwiki/tool/bundle/HelpPage.txt</value>
		</property>
		
		<property name="ownerAdmin"><value>true</value></property>
		<property name="ownerRead"><value>true</value></property>
		<property name="ownerWrite"><value>true</value></property>
		<property name="groupAdmin"><value>false</value></property>
		<property name="groupRead"><value>true</value></property>
		<property name="groupWrite"><value>false</value></property>
		<property name="publicRead"><value>false</value></property>
		<property name="publicWrite"><value>false</value></property>
		
		<property name="rwikiObjectContentDao"><ref bean="rwikiCurrentObjectContentDaoImpl"/></property>
	</bean>
	<bean id="rwiki.seedPage.HelpPagetwo"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.RWikiCurrentObjectImpl"
		init-method="init" singleton="true">
		<property name="name"><value>HelpPagetest</value></property>
		
		<property name="source">
			<value>/uk/ac/cam/caret/sakai/rwiki/tool/bundle/HelpPage.txt</value>
		</property>
		
		<property name="ownerAdmin"><value>true</value></property>
		<property name="ownerRead"><value>true</value></property>
		<property name="ownerWrite"><value>true</value></property>
		<property name="groupAdmin"><value>false</value></property>
		<property name="groupRead"><value>true</value></property>
		<property name="groupWrite"><value>false</value></property>
		<property name="publicRead"><value>true</value></property>
		<property name="publicWrite"><value>false</value></property>
		<property name="rwikiObjectContentDao"><ref bean="rwikiCurrentObjectContentDaoImpl"/></property>
		
	</bean>
	<!-- this is the default page template for new pages -->
	<bean id="rwiki.seedPage.DefaultTemplate"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.RWikiCurrentObjectImpl"
		init-method="init" singleton="true">
		<property name="name"><value>default_template</value></property>
		
		<property name="source">
			<value>/uk/ac/cam/caret/sakai/rwiki/tool/bundle/DefaultPageTemplate.txt</value>
		</property>
		
		<property name="ownerAdmin"><value>true</value></property>
		<property name="ownerRead"><value>true</value></property>
		<property name="ownerWrite"><value>true</value></property>
		<property name="groupAdmin"><value>true</value></property>
		<property name="groupRead"><value>true</value></property>
		<property name="groupWrite"><value>true</value></property>
		<property name="publicRead"><value>false</value></property>
		<property name="publicWrite"><value>false</value></property>
		<property name="rwikiObjectContentDao"><ref bean="rwikiCurrentObjectContentDaoImpl"/></property>
		
	</bean>
	<bean id="rwiki.seedPage.RecentChangesPage"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.RWikiCurrentObjectImpl"
		init-method="init" singleton="true">
		<property name="name"><value>Recent Changes</value></property>
		
		<property name="source">
			<value>/uk/ac/cam/caret/sakai/rwiki/tool/bundle/RecentChanges.txt</value>
		</property>
		
		<property name="ownerAdmin"><value>true</value></property>
		<property name="ownerRead"><value>true</value></property>
		<property name="ownerWrite"><value>true</value></property>
		<property name="groupAdmin"><value>false</value></property>
		<property name="groupRead"><value>true</value></property>
		<property name="groupWrite"><value>false</value></property>
		<property name="publicRead"><value>true</value></property>
		<property name="publicWrite"><value>false</value></property>
		<property name="rwikiObjectContentDao"><ref bean="rwikiCurrentObjectContentDaoImpl"/></property>
		
	</bean>
		<bean id="rwiki.seedPage.EditRightPage"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.RWikiCurrentObjectImpl"
		init-method="init" singleton="true">
		<property name="name"><value>Edit_right</value></property>
		
		<property name="source">
			<value>/uk/ac/cam/caret/sakai/rwiki/tool/bundle/EditRight.txt</value>
		</property>
		
		<property name="ownerAdmin"><value>true</value></property>
		<property name="ownerRead"><value>true</value></property>
		<property name="ownerWrite"><value>true</value></property>
		<property name="groupAdmin"><value>false</value></property>
		<property name="groupRead"><value>true</value></property>
		<property name="groupWrite"><value>false</value></property>
		<property name="publicRead"><value>true</value></property>
		<property name="publicWrite"><value>false</value></property>
		<property name="rwikiObjectContentDao"><ref bean="rwikiCurrentObjectContentDaoImpl"/></property>
			
	</bean>
	<!--
	<bean id="baseRenderEngine"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager"><ref
				bean="uk.ac.cam.caret.sakai.rwiki.RWikiTransactionManager"/>
			</property>
		<property name="transactionAttributes">
			<props>
				<prop key="render*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
		<property name="target"><ref bean="baseRenderEngineImpl"/></property>
	</bean>
	-->

	<bean id="baseRenderEngine" class="uk.ac.cam.caret.sakai.rwiki.radeox.service.impl.RWikiBaseRenderEngine" init-method="init">
		<property name="log"><ref bean="rwiki-logger"/></property>
	</bean>


	<bean id="rwikiCacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" >
		
	</bean>
	<bean id="rwikiCache" class="org.springframework.cache.ehcache.EhCacheFactoryBean" >
		<property name="cacheName"><value>rwiki-render-cache</value></property>
		<property name="cacheManager"><ref bean="rwikiCacheManager"/></property>
	</bean>
	
	<bean id="rwikiRenderCache" class="uk.ac.cam.caret.sakai.rwiki.radeox.service.impl.RenderCacheImpl" >
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="cache"><ref bean="rwikiCache" /></property>
	</bean>
	
		
	<bean id="rwikiPropertyDao"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiTransactionManager"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="update*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
		<property name="target"><ref bean="rwikiPropertyDaoImpl"/></property>
	</bean>
	<!-- DAO for current Object, acessed via Transaction Proxy -->
	<bean id="rwikiPropertyDaoImpl"
		class="uk.ac.cam.caret.sakai.rwiki.dao.impl.RWikiPropertyDaoImpl"
		singleton="true">
		<property name="sessionFactory"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
		</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
	</bean>
	
	
	
	<bean id="rwikiDataMigration"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiTransactionManager"/>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="update*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
		<property name="target"><ref bean="rwikiDataMigrationImpl"/></property>
	</bean>
	
	<bean id="rwikiDataMigrationImpl" 
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.DataMigrationSpecification" >
		<property name="targetVersion"  ><ref bean="rwikiCurrentSchemaVersion" /></property>
		<property name="migrationAgents">
			<list>
				<ref bean="rwiki-data-migrate-noneTo20051017" />
				<ref bean="rwiki-data-migrate-applyCurrentSHA1" />
				<ref bean="rwiki-data-migrate-applyHistorySHA1" />
			</list>
		</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="propertyDao"><ref bean="rwikiPropertyDaoImpl" /></property>
	</bean>
	
	<bean id="rwikiCurrentSchemaVersion" 
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.RWikiPropertyImpl">
		<property name="name"><value>schema-version</value></property>
		<property name="value"><value>20051017</value></property>
	</bean>
	
	<bean id="rwiki-data-migrate-noneTo20051017"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.SQLScriptMigration" >
		<property name="to"><value>20051017-S1</value></property>
		<property name="script">
			<value>/uk/ac/cam/caret/sakai/rwiki/model/bundle/mysql/migrateTo20051017.sql</value>
		</property>
		<property name="sessionFactory"><ref
			bean="uk.ac.cam.caret.sakai.rwiki.RWikiSessionFactory"/>
		</property>
		<property name="log"><ref bean="rwiki-logger"/></property>
	</bean>
	<bean id="rwiki-data-migrate-applyCurrentSHA1"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.SHAHashMigration" >
		<property name="from"><value>20051017-S1</value></property>
		<property name="to"><value>20051017-S2</value></property>
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="rwikiObjectDao"><ref bean="rwikiCurrentObjectDaoImpl"/></property>
	</bean>
	<bean id="rwiki-data-migrate-applyHistorySHA1"
		class="uk.ac.cam.caret.sakai.rwiki.model.impl.SHAHashMigration" >
		<property name="from"><value>20051017-S2</value></property>
		<property name="to"><value>20051017</value></property>
		<property name="log"><ref bean="rwiki-logger"/></property>
		<property name="rwikiObjectDao"><ref bean="rwikiHistoryObjectDaoImpl"/></property>
	</bean>
	
</beans>
