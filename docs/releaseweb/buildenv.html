<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<html>
<head>

<title>Set Up Build Environment</title>
 <link href="styles/pos.css" rel="stylesheet" type="text/css" />
 <link href="styles/styles3.css" rel="stylesheet" type="text/css" />
</head>

<body>

<div id="frame">

	<div id="contentheader">
	<a href="http://www.sakaiproject.org/">
<img src="images/logoslate160x89.jpg" alt="Sakai Logo"
 border="0" /></a>
	</div>

<div id="contentcenter">

	<div id="contentleft">

	<div id="bar">
	  &nbsp;
	  <!--END BAR-->
	</div>

<div class="pad">
<h2>Installation Guide<br>Table of Contents</h2>
<ol>
<li>
<a href="InstallGuide.html">Installation Overview</a></li>
<ul class="toc">
	<li><a href="#choose">1.1 Choose an Install Type</a></li>
	<li><a href="#demo">1.2 Demo Installation</a></li>
	<li><a href="#binary">1.3 Binary Installation</a></li>
	<li><a href="#overview">1.4 Source Install Phases</a></li>
	<li><a href="#migrating">1.5 Migrating from a Previous Release</a></li>
</ul>
<li>
<a href="buildenv.html">Set Up Build Environment</a>
<ul class="toc">
  <li><a href="buildenv.html#verify">2.1 Verify Java installation</a></li>
  <li><a href="buildenv.html#set">2.2 Set environment variables</a></li>
  <li><a href="buildenv.html#tomcat">2.3 Install
  Tomcat</a></li>
  <li><a href="buildenv.html#configurationtc">2.4 Configure Tomcat</a></li>
  <li><a href="buildenv.html#maven">2.5 Install Maven</a></li>
  <li><a href="buildenv.html#configurationm">2.6 Configure Maven</a></li>
  <li><a href="buildenv.html#testm">2.7 Test Maven</a></li>
  </li>
 </ul>
<li>
<a href="build.html">
  Build and Deploy Sakai</a>
<ul class="toc">
<li><a href="build.html#download">3.1 Download source</a></li>
  <li><a href="build.html#unpack">3.2 Unpack source</a></li>
  <li><a href="build.html#runmaven">3.3 Run maven</a></li>
</ul>
</li>

<li>
  <a href="postconfig.html">Post-Installation Configuration</a>
<ul class="toc">
<li><a href="postconfig.html#folder">4.1 Create sakai folder <br />
for properties files</a> </li>
  <li> <a href="postconfig.html#properties">4.2 The
sakai.properties file</a> </li>
  <li><a href="postconfig.html#personalize">4.3 Personalizing Sakai</a> </li>
  <li><a href="postconfig.html#email">4.4 Email configuration</a> </li>
  <li><a href="postconfig.html#jvm">4.5 JVM tuning</a> </li>
  <li><a href="postconfig.html#test">4.6 Test Sakai</a> </li>
</ul>
</li>

<li>
  <a href="dbconfig.html">Database Configuration</a>
<ul class="toc">
  <li><a href="dbconfig.html#updating">5.1 Migrating from a Previous Version</a></li>
  <li><a href="dbconfig.html#deployd">5.2 Deploy drivers</a> </li>
  <li><a href="dbconfig.html#create">5.3 Create Sakai database and user</a> </li>
  <li><a href="dbconfig.html#sproperties">5.4 Database Properties</a> </li>
</ul>
</li>
<li>
  <a href="tshoot.html">Troubleshooting</a>
<ul class="toc">
  <li><a href="tshoot.html#common">6.1 Common Issues</a> </li>
  <li><a href="tshoot.html#maven">6.2 Working with Maven</a> </li>
  <li><a href="tshoot.html#logs">6.3 Tomcat logs</a> </li>
</li>
</ul>
</li>
</ol>
<p>&nbsp;</p>

    <!--END PAD-->
  </div>

   <!--END LEFT-->
</div>
<div class="pad">
<h1>2. Set up Build Environment</h1>


<!-- Guide Contents -->
<a href="#verify"></a>
<h2>2.1 Verify Java installation</h2>
   <br />Check to see if you have Java 1.4.2 (1.4 is required; Java 1.5 will not work) installed on your system by running the following command:
<br />
<table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <th>OS</th>
          <th>Sample Output</th>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Windows:</span></td>
          <td class="white"><pre><span class="code">C:\&gt; java -version<br>Java(TM) 2 Runtime Environment, Standard Edition <br>(build 1.4.2_04-141.3)<br>Java HotSpot(TM) Client VM (build 1.4.2-38, mixed mode)</span></pre></td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">*nix variants:</span> </td>
          <td class="white">
          <pre><span class="code">$ java -version<br>java version "1.4.2_04"<br>Java(TM) 2 Runtime Environment, Standard Edition <br>(build 1.4.2_04-141.3)<br>Java HotSpot(TM) Client VM (build 1.4.2-38, mixed mode)</span></pre>
          </td>
        </tr>
      </tbody>
    </table>
    <p> If
you do not have the
correct version of Java installed, install
the Java Software
Development Kit (SDK) from&nbsp;<a
 href="http://java.sun.com/j2se/1.4.2/download.html">http://java.sun.com/j2se/1.4.2/download.html</a>&nbsp;
    </p>

  <p></p>
 <h2>2.2 Set Environment Variables</h2></li>
    <br/>Set the JAVA_HOME environment variable to point to the base directory
	of your Java installation. This will enable Tomcat to find the right
	Java installation automatically. This may already be set up for you by
your Java SDK installation, but it should be double-checked.
<p></p>
   In the UNIX operating systems, you typically modify a startup
file like ~/.bash_login to set and export these shell variables. In
Windows XP, you go to
	<br><em>Start -&gt; Control
Panel -&gt; System
-&gt;
Advanced -&gt; Environment Variables</em>
<br>
And then set them as described below:

	</ol>

<table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <th>OS</th>
          <th>Sample Output</th>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Windows:</span></td>
          <td class="white"><span class="code">Set the environment variable JAVA_HOME to "C:\j2sdk1.4.2_04"
(do not include the quotes)</span></td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Mac:</span> </td>
          <td class="white">
          <pre><span class="code">export JAVA_HOME=/Library/Java/Home</span></pre>
          </td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Linux:</span> </td>
          <td class="white">
          <pre><span class="code">export JAVA_HOME=/usr/local/java-current</span></pre>
          </td>
        </tr>
      </tbody>
    </table>
    <p>Next you'll want to extend the PATH variable so as to include the Java commands.</p>

    <table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <th>OS</th>
          <th>Sample Output</th>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Windows:</span></td>
          <td class="white"><span class="code">Append the string ";C:\j2sdk1.4.2_04\bin" (include the
semicolon but not the quotes) to the end of the system variable
named Path.</span></td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Mac:</span> </td>
          <td class="white"><pre><span class="code">not necessary</span></pre></td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">*nix:</span> </td>
          <td class="white">
          <pre><span class="code">export PATH=$PATH:$JAVA_HOME/bin/</span></pre>
          </td>
        </tr>
      </tbody>
    </table>
    <p>You should test that these variables are set correctly. &nbsp;In both Windows XP and *nix operating systems you can simply start a new shell
and type the 'set' command to see your environment variables. You may run the <span class="code">java -version</span> command once more (see above) as a final check. </p>
    <p>You can also look for the <a href="http://java.sun.com/j2se/1.4.2/install.html">Sun Java Installation Instructions</a> page at the Java web site for further details.</p>


  <a name="tomcat"></a>


    <p><h2>2.3 Install Tomcat<br />
    </h2><br/>Sakai 2.1.1 was QA'ed with Tomcat 5.5.9, but the latest stable version
of Tomcat 5.5 (currently 5.5.15) will likely not present problems.  Tomcat can be downloaded as a binary
from:<br />
<a
 href="http://tomcat.apache.org/download-55.cgi">http://tomcat.apache.org/download-55.cgi</a>
 <br>The distribution you want is the one labeled <em>Core</em>, along with the <em>JDK 1.4 Compatability Package</em>.</p>
 <p></p>
 <table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
       <tbody>
         <tr>
           <th>Windows Note</th>
         </tr>
         <tr>
           <td class="white">Windows users have the option of either downloading an .exe Tomcat installer or a .zip binary. Although either may serve, they are however not entirely equivalent when it comes to the startup scripts they include, and for brevity's sake subsequent instructions will simply assume that you grabbed the .zip file.</td>
         </tr>
       </tbody>
    </table>
    <p>Choose a location to
install Tomcat, and unpack both the Tomcat binary and the compatibility package there in the same location.  The compatibility package will simply overlay your Tomcat directories with the appropriate files. From this point forward these instructions will refer to the top-level Tomcat directory (e.g. apache-tomcat-5.5.9) as $CATALINA_HOME. You may set this as an environment variable for convenience's sake, but this is not required. &nbsp;Make sure that you have write permissions to the Tomcat files and directories before proceeding, or you may later run into errors during the build phase.</p>

  <a name="configurationtc"></a>

    <p><h2>2.4 Configure Tomcat</h2></p>
    <br/>Sakai supports UTF-8, allowing for non-Roman characters, but this requires that Tomcat be configured to accept UTF-8 URLs, since it ships with ISO-8859-1 as the default URL encoding. To change this setting, edit $CATALINA_HOME/conf/server.xml. Add the attribute URIEncoding="UTF-8" to the &lt;connector&gt; element. For example:</p>
    <pre><span class="code">&lt;Connector<br>port="8080" maxThreads="150" minSpareThreads="25" maxSpareThreads="75"<br>enableLookups="false" redirectPort="8443" acceptCount="100"<br>debug="0" connectionTimeout="20000" disableUploadTimeout="true"<br>URIEncoding="UTF-8"/&gt;<br></span></pre>
  </li>
  <p>If you want to run Tomcat on different ports than the defaults, this would also be a good time to
make those changes in the server.xml file. See <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/index.html">Tomcat configuration documentation</a> for more details.</p>
  <p>If you're going to run Tomcat in isolation (i.e. if you're not going to connect it to Apache) then you'll want to make a further minor Tomcat change that may spare some confusion later. In order to make sure that entering the URL to your server will redirect to the Sakai application seamlessly, you'll need to copy an index.html file to webapps/ROOT. The ROOT webapp is the one served up when a request is made to your web server's root URL. The index.html file to add to webapps/ROOT simply redirects browsers to the full URL of the gateway page, and it should look something like:</p>
  <pre><span class="code">&lt;html&gt;<br>&lt;head&gt;
  &lt;meta http-equiv="refresh" content="0;url=/portal"&gt;
&lt;/head&gt;<br>&lt;body&gt;<br>  redirecting to /portal ...
&lt;/body&gt;<br>&lt;/html&gt;</span></pre>
  <p>If you don't make this change you'll need to append '/portal' to the URL you enter to access Sakai each time.  If you are going to connect Tomcat with Apache, you can handle this as a matter of Apache configuration, which is however outside the scope of this document.</p>
<a name="maven"></a>

    <p><h2>2.5 Install Maven</h2></p>
    </span><br/>Maven is the build tool
used by Sakai, and the latest stable release (currently 1.0.2) can be
downloaded from:<br />
<a href="http://maven.apache.org/start/download.html">http://maven.apache.org/start/download.html</a></p>
<p></p>
<table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
       <tbody>
         <tr>
           <th>Newer versions of Maven</th>
         </tr>
         <tr>
           <td class="white">It's important that Maven 1.0.2 be used. There are betas for Maven 1.1 and Maven 2.0 currently available, but neither will work for Sakai 2.1. Many plugins have not yet been adapted for the new Maven architecture.</td>
         </tr>
       </tbody>
    </table>
    <p>Choose a location to
install Maven, and unpack the archive there. You will have a top-level
directory named maven-&lt;VERSION&gt;
(e.g. maven-1.0.2).</p>

  <a name="configurationm"></a>

    <p><h2>2.6 Configure Maven</h2></p>
    </span><br/>To use Maven you'll need to
set two environment variables and then create a local repository using a
script provided by Maven.</p>
    <p>First, define the
MAVEN_HOME environment variable which
is the directory where you just unpacked the Maven install archive. You
will also need to add MAVEN_HOME/bin to your path so that you can run
the scripts provided with Maven.</p><br />
    <table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <th>OS</th>
          <th>Sample Output</th>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Windows:</span></td>
          <td class="white">Create a new
MAVEN_HOME environment variable to "C:\maven-1.0.2"<br>
Append to the PATH variable ";C:\maven-1.0.2\bin" </td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Mac/*nix:</span> </td>
          <td class="white">
          <pre><span class="code">export MAVEN_HOME=/usr/local/maven<br>export PATH=$PATH:$MAVEN_HOME/bin</span></pre>
          </td>
        </tr>
      </tbody>
    </table>
    <p> Next, you should create
your local repository by running the following command:</p>
    <table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <th>OS</th>
          <th>Sample Output</th>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Windows:</span></td>
          <td class="white">
          <pre><span class="code">install_repo.bat %HOMEDRIVE%%HOMEPATH%\.maven\repository</span></pre>
          </td>
        </tr>
        <tr>
          <td class="white"><span style="font-weight: bold;">Mac/*nix:</span> </td>
          <td class="white">
          <pre><span class="code">install_repo.sh $HOME/.maven/repository</span></pre>
          </td>
        </tr>
      </tbody>
    </table>
    <p>Finally, you'll need to
create a build properties file in your home directory which will configure
Maven for your Sakai build. Simply create a new text file with the
filename <span style="font-weight: bold;">build.properties</span>
in your home
directory, and paste in the following contents:</p>
    <pre><span class="code">maven.repo.remote=http://cvs.sakaiproject.org/maven/,http://source.sakaiproject.org/mirrors/ibiblio/maven/<br/>maven.tomcat.home=/usr/local/tomcat/</span></pre>
    <p>  </p>
<p></p>
<table bgcolor="#ccddff" border="0" cellpadding="2" cellspacing="2">
       <tbody>
         <tr>
           <th>build.properties syntax</th>
         </tr>
         <tr>
           <td class="white">Maven is very sensitive to the syntax of the build.properties file.  Be sure not to omit the trailing slashes as shown above, and be sure to change the value of <em>maven.tomcat.home</em> to match the path to your Tomcat installation.
           <p></p>
           Further, if you are running on Windows special care is needed in identifying your tomcat home. Maven wants Unix-style forward slashes, "/", and is confused by Windows-style backslashes "\". If you have your tomcat located in "c:\tomcat", for example, you need to identify it like this:</p>
    <pre><span class="code">maven.tomcat.home = c:/tomcat/</span></pre></td>
         </tr>
       </tbody>
    </table>
    <p>

  <a name="testm"></a>
<h2>2.7 Test Maven</h2><br />
    To confirm that you can start Maven, run the command:
    <pre><span class="code">maven -v</span></pre>
	This should start maven and cause it to report its version.
	<p></p>
	At this point your environment is prepared to build and deploy the Sakai source code.  Please continue on to the <a href="build.html">Build and Deploy</a> section.


<p>&nbsp;</p>

<!--END CONTENT-->
</div>
</div>
<br clear="all" /><!-- without this little <br /> NS6 and IE5PC do not stretch the frame div down to encopass the content DIVs -->
  <!--END FRAME-->
</div>
</body>
</html>
