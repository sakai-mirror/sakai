

                          Sakai Site-Group Security


                              October 22, 2005

         Please direct questions or comments about this document to:

        Glenn R. Golden, Sakai Framework Architect, ggolden@umich.edu


Introduction

Sakai 2.1 introduces groups in the site API.  Site groups are collections
of users, each with a role and group-specific permissions.  This document
describes how security works with site-groups; both for the site
maintenance, and for related entities, featuring the announcement
application's use of group security.


Site Security


Sites are composed of some parts, including:
    - pages
    - tool placements
    - membership
    - groups (with their meta data and membership)

When maintaining a site, any part of the site, security is based on
permissions granted to users (via their roles) at the site level.  Even
thougha  site-group has a membership with permissions, group maintenance
controlled at the site level.

Any member of a site with the "site.upd" permission can make changes to the
site, the pages and tools in the site, and the site membership; those users
can create and delete site groups and change group meta data, membership
and permissions.  These users do not need to have any specific site-group
membership to do this.

This supports the expected behavior; instructors, or maintain role users,
can modify any aspect of the site.


Site API extention


The Site API has been extended to include membership methods at the site
and group levels.  This means that your code (internal, or via web
services) can maintain the site membership and group membership using the
Site and Group objects from the site API; there is no further need to use
the AuthzGroupService directly.  In fact, you should avoid using the
AuthzGroup API for site and group membership; it is possible that your end
user will not have permission to modify the site or site-group's authzGroup
directly; but they will have permission to modify the site and site / group
membership.


Announcement Grouping and Security


With the 2.1 framework site-group support, the announcement application is
modified to support grouped announcements.  Announcements now can be:
    - for public access
    - for the entire site
    - for one or more groups of the site

Announcements that are set with site level access are under the security
definitions at the site level (or the channel level, which is available but
not used much in Sakai at present).  To read site access announcements, the
end user needs to be a member of the site, and have a role that has been
granted the "annc.read" permission in the site.

Announcements that are grouped are marked as being associated with one or
more site groups.  For the end user to be able to see a grouped
announcement, they need to have a role in the site that grants them
"annc.read" (else they are blocked from seeing anything about announcements
in the site), and they must be a member with the "annc.read" permission in
at least one of the site-groups that the announcements is associated with.

To create an announcement that is marked with site access, the end user
must have the appropriate permission with their site membership.

To create an announcement that is grouped, the end user must have
membership in all of the groups they wish to select for the announcement,
and appropriate creation permissions in all of those groups.  They do not
need to have creation permission in the site to create a grouped
announcement.

To modify an announcement, the end user must have appropriate permission
based on what sort of access the announcement is set to.  If it is marked
for site access, the end user must have modify permission with their site
membership.  If it is marked for grouped access, the end user must have
modify permission in all of the groups that the announcement is associated
with.

After modification, the end user can modify the announcement's access only
to those choices that they have permission for.   To save the announcement,
the end user must have permission to the newly modified announcement, as if
they were attempting to edit it again.



All Group Access


Maintain role members of the site (Instructors and the like) might expect
to have permissions to see and manipulate the announcements in the site as
well as all the site groups, without having explicit membership in each
group.  To support this, we have introduced a new announcement security
function, "annc.all.groups".  If the user's membership in the site includes
this function, then the user has access to all the groups in the site
without needing explicit group membership.

The Sakai authzGroup templates include this permission for site "maintain"
and course site "instructor" roles; you can add this to any role that you
whish to have this capability.


Database Conversion


Sakai 2.1 upgrades from prior Sakai versions may wish to adjust the
authorization groups to include the new "annc.all.groups" permission, and
to create new site group templates.

Authorization group templates can be edited using the admin's Authorization
Group editor directly.  Instructor and other maintain type roles can be
adjusted to include this new permission.  After this, all new sites will
include the definition from the template

The new templates can be created manually, or the SQL can be run directly
to the database, from the Sakai source that creates the site group
templates ("!group.template" and "!group.template.course", and additional
"!group.template"s for each additional site type you are using).

The body of existing site authorization groups should be updated as well.
A record that gives the "maintain" role or the "instructor" role the new
"annc.all.groups" permission needs to be added to the SAKAI_REALM_RL_FN
table, one record for each REALM_KEY that has a ROLE_KEY matching
"instructor" or "maintain".

Something like this:

      INSERT INTO SAKAI_REALM_RL_FN VALUES
      ((select REALM_KEY from SAKAI_REALM where REALM_ID = REALM_ID_HERE),
      (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME =
      ROLE_NAME_HERE),
      (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME =
      'annc.all.groups'));

filling in the REALM_ID_HERE and ROLE_NAME_HERE as appropriate.

A similar process is needed to support the new sections tool, which has
some new permissions that must be added to all course site student, ta, and
instructor type roles.

Once I figure out the clever way to do this with back-end SQL commands,
I'll update the document.  Another possibility is we will extend the admin
Authorization Group editor to support this sort of bulk-update process.

