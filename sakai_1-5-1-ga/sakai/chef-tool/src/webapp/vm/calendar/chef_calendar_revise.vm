## $Header: /cvs/sakai/chef-tool/src/webapp/vm/calendar/chef_calendar_revise.vm,v 1.6 2005/02/01 00:32:39 gsilver.umich.edu Exp $

<script type="text/javascript">
focus_path = [ "activitytitle" ];

function hourChange(FieldName)
{
    var startHour;
    var startMinute;
    var endHour;
    var endMinute;
    var duHour;
    var duMinute;

    if (navigator.appName == "Netscape")
    {
    blur();
    self.focus();
    }

    switch(FieldName)
    {
        case 'startHour':
        case 'startMinute':
        {
            startHour = parseInt(document.getElementById('startHour').value);
            if (startHour != 100)
                minuteChange(FieldName);
            else <!-- if the start hour is change back to null -->
            {
                document.getElementById('endHour').selectedIndex = 0;
                document.getElementById('endMinute').selectedIndex = 0;
            }
        } break;
        case 'duHour':
        case 'duMinute':
        {
            minuteChange(FieldName);
        } break;
        <!-- if endHour is changed, modify the duration hour relatively -->
        case 'endHour': <!-- same as minuteChange case endMinute -->
        case 'endMinute':
        {
            minuteChange(FieldName);
        } break;
    }
}

function minuteChange(FieldName)
    {
        var startHour;
        var startMinute;
        var duMinute;
        var endMinute;

        switch(FieldName)
        {
        case 'startMinute':
        case 'duMinute':
        case 'startHour': 
        case 'duHour': 
        {
        startHour = parseInt(document.getElementById('startHour').value);
        if (startHour != 100)
        {
            startMinute = parseInt(document.getElementById('startMinute').value);
            duMinute = parseInt(document.getElementById('duMinute').value);
            endMinute = startMinute + duMinute;

            duHour = parseInt(document.getElementById('duHour').value);
            endHour = startHour + duHour;
            if (endMinute >= 60)
            {
                document.getElementById('endMinute').selectedIndex = (endMinute-60)/5;

                endHour = endHour + 1;
                if ((endHour > 12) && (endHour <= 24))
                    endHour = endHour - 12;
                else
                {
                    if (endHour > 24)
                            endHour = endHour - 24;
                }
            }
            else <!-- if endMinute < 60 -->
            {
                document.getElementById('endMinute').selectedIndex = endMinute/5;

                if ((endHour > 12) && (endHour <= 24))
                        endHour = endHour - 12;
                else
                {
                    if (endHour > 24)
                            endHour = endHour - 24;
                }
            }
            document.getElementById('endHour').selectedIndex = endHour;

             <!-- the ampm issue is decided by if (12-start)< du-->
            if (startHour < 12)
            {
                var sm = startHour * 60 + startMinute;
                var dm = duHour * 60 + duMinute;
                var em = sm + dm;
                var halfdaym = 12 * 60;
                var wholedaym = 24 * 60;
                if ((em < halfdaym) || (em >= wholedaym)) 
                {
                    <!-- endHour still falls in the same half day -->
                    startAmpmIndex = document.getElementById('startAmpm').selectedIndex;
                    document.getElementById('endAmpm').selectedIndex = Math.abs(startAmpmIndex);
                }
                else if ((em >= halfdaym) && (em < wholedaym))
                {
                    startAmpmIndex = document.getElementById('startAmpm').selectedIndex;
                    document.getElementById('endAmpm').selectedIndex = Math.abs(startAmpmIndex - 1);
                }
            }
            else if (startHour = 12)
            {
                var sm = 12 * 60 + startMinute;
                var dm = duHour * 60 + duMinute;
                var em = sm + dm;
                var oneandhalfdaym = 36 * 60;
                var wholedaym = 24 * 60;
                if ((em < wholedaym) || (em >= oneandhalfdaym))
                {
                    <!-- endHour still falls in the same half day -->
                    startAmpmIndex = document.getElementById('startAmpm').selectedIndex;
                    document.getElementById('endAmpm').selectedIndex = Math.abs(startAmpmIndex);
                }
                else if ((em >= wholedaym) && (em < oneandhalfdaym))
                {
                    startAmpmIndex = document.getElementById('startAmpm').selectedIndex;
                    document.getElementById('endAmpm').selectedIndex = Math.abs(startAmpmIndex - 1);
                }
            }
         } <!-- if startHour not equal to 0 -->
        } break;

        case 'endHour':
        case 'endMinute':
        case 'endAmpm':
        {
            startHour = parseInt(document.getElementById('startHour').value);
            if (startHour != 100)
            { <!-- ampm changes need to be considered as well -->
                startMinute = parseInt(document.getElementById('startMinute').value);
                endMinute = parseInt(document.getElementById('endMinute').value);
                duMinute = endMinute - startMinute;

                endHour = parseInt(document.getElementById('endHour').value);
                duHour = endHour - startHour;

                startAmpmIndex = document.getElementById('startAmpm').selectedIndex;
                endAmpmIndex = document.getElementById('endAmpm').selectedIndex;
                sm = (startHour + startAmpmIndex * 12) * 60 + startMinute;
                em = (endHour + endAmpmIndex * 12) * 60 + endMinute;
                if (em == sm)
                { <!-- set duTime to be zero -->
                    duHour = 0; 
                    duMinute =0;
                }
                else if (em < sm) 
                { <!-- end time is earlier than start time -->
                    dm = em - sm + 24 * 60;
                    duMinute = dm % 60;
                    duHour = Math.floor(dm / 60);
                }
                else
                {
                    dm = em - sm;
                    duMinute = dm % 60;
                    duHour = Math.floor(dm / 60);
                }
                document.getElementById('duHour').selectedIndex = duHour; 
                document.getElementById('duMinute').selectedIndex = duMinute/5;
            }
        } break;
    }
}

function ampmChange(FieldName)
{
    var startAmpm;
    var endAmpm;

    if (navigator.appName == "Netscape")
    {
    blur();
    self.focus();
    }

    switch(FieldName)
    {
        case 'startAmpm':
        {
            
            startHour = parseInt(document.getElementById('startHour').value);
            if (startHour != 100)
            {
                startAmpm = document.getElementById('startAmpm').value;
                endAmpmIndex = document.getElementById('endAmpm').selectedIndex;
                document.getElementById('endAmpm').selectedIndex = Math.abs(endAmpmIndex - 1);           
            }
        } break;
        case 'endAmpm': 
        {
            minuteChange(FieldName);
        } break;
    }
}

</script>

<div class="chefPortletContainer">
	<div class ="chefPortletToolBarMessage">
		Revising schedule item...
	</div>
<div class="chefPortletContent">
#if ($alertMessage)<div class="chefAlertBox">Alert: $validator.escapeHtml($alertMessage)</div>#end
<div class="chefPageviewTitle">
To revise the schedule item, update the form and choose 'post' at the bottom.<br />
A <span class="chefRequiredInline">means</span>required information.
</div>

<form action="#toolForm("$action")" method="post">
<fieldset>
<legend>Schedule Item</legend>

<table class="chefEditItem" cellspacing="0">  
<tr>
<td  class="chefLabel"><span class="chefRequiredInline">Title</span></td>
<td>
#if($savedData.getTitle().length() != 0)
    #set($str = $savedData.getTitle().trim())
    <input type="text" name="activitytitle" id="activitytitle" size="32" maxlength="50" value = "$validator.escapeHtml($str)" onfocus="minuteChange('startMinute'); return false;" />
#elseif ($calEventFlag != "false")
    #if ($event.getDisplayName().length() != 0)
        #set($str = $event.getDisplayName().trim())
        <input type="text" name="activitytitle" id="activitytitle" size="32" maxlength="50" value="$validator.escapeHtml($str)" onfocus="minuteChange('startMinute'); return false;" />
    #end
#else
    <input type="text" name="activitytitle" size="32" maxlength="50" value = "" />
#end
</td>
</tr>
		      
<tr>## valign="top">
<td  class="chefLabel">Description</td>
<td>
	<table border="0"><tr><td>
    #if($savedData.getDescription().length() != 0)
    <textarea name="description"  id="description" wrap="virtual" rows="15" cols="80">$validator.escapeHtmlFormattedTextarea($savedData.getDescription())</textarea>
 	#chef_setupformattedtextarea("description")
   #elseif ($calEventFlag != "false")
    #if($event.getDescriptionFormatted().length() != 0)
    <textarea name="description" id="description" wrap="virtual" rows="15" cols="80">$validator.escapeHtmlFormattedTextarea($event.getDescriptionFormatted())</textarea>
	#chef_setupformattedtextarea("description")
    #else
    <textarea name="description" id="description" wrap="virtual" rows="15" cols="80"></textarea>
	#chef_setupformattedtextarea("description")
    #end
    #else
    <textarea name="description" id="description" wrap="virtual" rows="15" cols="80"></textarea>
    #chef_setupformattedtextarea("description")
	#end
	</td></tr></table>
</td>
</tr>
    
<tr>
<td  class="chefLabel"><span class="chefRequiredInline">Date</span></td>
<td>## valign="middle" align="left">

	## Setup a date selection widget
	#set($todayYear = $realDate.breakdownLocal().Year)
	#set($earliestYear = $todayYear - 3)
	#set($latestYear = $todayYear + 4)	
	
	#if($savedData.getMonth()!=0)
		#set($month=$savedData.getMonth())
		#set($day=$savedData.getDay())
		#set($year=$savedData.getYearInt())
	#else
		#set($month = $event.getRange().firstTime().breakdownLocal().month)
		#set($day = $event.getRange().firstTime().breakdownLocal().day)
		#set($year = $event.getRange().firstTime().breakdownLocal().year)
	#end 

	#chef_dateselectionwidget("yearSelect" "month" "day" $earliestYear $latestYear $year $month $day)

 
    </td>
</tr>
<tr> 
    <td  class="chefLabel"><span class="chefRequiredInline">Start</span></td>
    <td>
		#set($time = $event.getRange().firstTime().toStringLocalFull())
		#set($hour = $event.getRange().firstTime().breakdownLocal().hour)
		#set($minute = $event.getRange().firstTime().breakdownLocal().min)
		
		#if ($endTime.endsWith("am")) #set ($endTimeType = "am") #else #set ($endTimeType = "pm") #end
        #if($savedData.getHour() != 0)
            #set($hour = $savedData.getHour())
        #end

        #if($hour>12)
            #set($hour = $hour - 12)
        #elseif ($hour == 0)
            #set($hour = 12)
        #end
        
        <select name="startHour" id="startHour" onchange="hourChange('startHour'); return false;">
        #if($hour == 1) <option selected="selected" value="1">1</option> #else <option value="1">1</option> #end
        #if($hour == 2) <option selected="selected" value="2">2</option> #else <option value="2">2</option> #end
        #if($hour == 3) <option selected="selected" value="3">3</option> #else <option value="3">3</option> #end
        #if($hour == 4) <option selected="selected" value="4">4</option> #else <option value="4">4</option> #end
        #if($hour == 5) <option selected="selected" value="5">5</option> #else <option value="5">5</option> #end
        #if($hour == 6) <option selected="selected" value="6">6</option> #else <option value="6">6</option> #end 
        #if($hour == 7) <option selected="selected" value="7">7</option> #else <option value="7">7</option> #end
        #if($hour == 8) <option selected="selected" value="8">8</option> #else <option value="8">8</option> #end
        #if($hour == 9) <option selected="selected" value="9">9</option> #else <option value="9">9</option> #end
        #if($hour == 10) <option selected="selected" value="10">10</option> #else <option value="10">10</option> #end
        #if($hour == 11) <option selected="selected" value="11">11</option> #else <option value="11">11</option> #end
        #if($hour == 12) <option selected="selected" value="12">12</option> #else <option value="12">12</option> #end
        </select>
        
        #if($savedData.getMinute() != -1)
            #set($minute = $savedData.getMinute())
        #end
        <select name="startMinute" id="startMinute" onchange="hourChange('startMinute'); return false;">
        #if($minute == 0) <option selected="selected" value="0">00</option> #else <option value="0">00</option> #end
        #if($minute == 5) <option selected="selected" value="5">05</option> #else <option value="5">05</option> #end
        #if($minute == 10) <option selected="selected" value="10">10</option> #else <option value="10">10</option> #end
        #if($minute == 15) <option selected="selected" value="15">15</option> #else <option value="15">15</option> #end
        #if($minute == 20) <option selected="selected" value="20">20</option> #else <option value="20">20</option> #end
        #if($minute == 25) <option selected="selected" value="25">25</option> #else <option value="25">25</option> #end
        #if($minute == 30) <option selected="selected" value="30">30</option> #else <option value="30">30</option> #end 
        #if($minute == 35) <option selected="selected" value="35">35</option> #else <option value="35">35</option> #end
        #if($minute == 40) <option selected="selected" value="40">40</option> #else <option value="40">40</option> #end
        #if($minute == 45) <option selected="selected" value="45">45</option> #else <option value="45">45</option> #end
        #if($minute == 50) <option selected="selected" value="50">50</option> #else <option value="50">50</option> #end
        #if($minute == 55) <option selected="selected" value="55">55</option> #else <option value="55">55</option> #end
        </select>
     
        #if($$savedData.getAm().length() != 0)
            #set($timeType = $savedData.getAm())
        #else
            #set($hourType = $event.getRange().firstTime().breakdownLocal().getHour())
            #if ($hourType>=12)
                #set($timeType = "pm")
            #else
                #set($timeType = "am")
            #end
        #end
        <select name="startAmpm" id="startAmpm" onchange="ampmChange('startAmpm'); return false;">
        #if($timeType =="am") <option selected="selected">am</option> #else <option>am</option> #end
        #if($timeType =="pm") <option selected="selected">pm</option> #else <option>pm</option> #end
        </select>
   </td>
</tr>


<tr>
    <td  class="chefLabel">Duration</td>
    <td>
        ## if back from attachment, there is the saved data
        #if($savedData.getDurationHour() != -1)
            #set($dhour = $savedData.getDurationHour())
        #else
            #set($dhour = $helper.getduration($event.getRange().duration(),3600000))
        #end
        
        #set($dmi = 0)
        #if($savedData.getDurationMinute() != -1)
            #set($dmi = $savedData.getDurationMinute())
        #else
            #set($du = $event.getRange().duration())
            #set($dmi = $helper.getFractionIn($du,$dhour))

            ## if the duration minute ends with "4" or "9"
            ## it needs to be formatted
            #if (($dmi % 5) != 0)
                #set ($dmi = $dmi + 1)
            #end
            #if ($dmi == 60)
                #set ($dmi = 0)
                #if ($dhour == 12)
                    #set ($dhour = 1)
                #else
                    #set ($dhour = $dhour + 1)
                #end
            #end
        #end

<select name="duHour" id="duHour" onchange="hourChange('duHour'); return false;">
#if($dhour == 0) <option selected="selected" value="0">0</option> #else <option value="0">0</option> #end
#if($dhour == 1) <option selected="selected" value="1">1</option> #else <option value="1">1</option> #end
#if($dhour == 2) <option selected="selected" value="2">2</option> #else <option value="2">2</option> #end
#if($dhour == 3) <option selected="selected" value="3">3</option> #else <option value="3">3</option> #end
#if($dhour == 4) <option selected="selected" value="4">4</option> #else <option value="4">4</option> #end
#if($dhour == 5) <option selected="selected" value="5">5</option> #else <option value="5">5</option> #end
#if($dhour == 6) <option selected="selected" value="6">6</option> #else <option value="6">6</option> #end 
#if($dhour == 7) <option selected="selected" value="7">7</option> #else <option value="7">7</option> #end
#if($dhour == 8) <option selected="selected" value="8">8</option> #else <option value="8">8</option> #end
#if($dhour == 9) <option selected="selected" value="9">9</option> #else <option value="9">9</option> #end
#if($dhour == 10) <option selected="selected" value="10">10</option> #else <option value="10">10</option> #end
#if($dhour == 11) <option selected="selected" value="11">11</option> #else <option value="11">11</option> #end
#if($dhour == 12) <option selected="selected" value="12">12</option> #else <option value="12">12</option> #end
#if($dhour == 13) <option selected="selected" value="13">13</option> #else <option value="13">13</option> #end
#if($dhour == 14) <option selected="selected" value="14">14</option> #else <option value="14">14</option> #end
#if($dhour == 15) <option selected="selected" value="15">15</option> #else <option value="15">15</option> #end
#if($dhour == 16) <option selected="selected" value="16">16</option> #else <option value="16">16</option> #end
#if($dhour == 17) <option selected="selected" value="17">17</option> #else <option value="17">17</option> #end
#if($dhour == 18) <option selected="selected" value="18">18</option> #else <option value="18">18</option> #end
#if($dhour == 19) <option selected="selected" value="19">19</option> #else <option value="19">19</option> #end
#if($dhour == 20) <option selected="selected" value="20">20</option> #else <option value="20">20</option> #end
#if($dhour == 21) <option selected="selected" value="21">21</option> #else <option value="21">21</option> #end
#if($dhour == 22) <option selected="selected" value="22">22</option> #else <option value="22">22</option> #end
#if($dhour == 23) <option selected="selected" value="23">23</option> #else <option value="23">23</option> #end
</select>
hours
<select name="duMinute" id="duMinute" onchange="hourChange('duMinute'); return false;">
#if($dmi == 0) <option selected="selected" value="0">00</option> #else <option value="0">00</option> #end
#if($dmi == 5) <option selected="selected" value="5">05</option> #else <option value="5">05</option> #end
#if($dmi == 10) <option selected="selected" value="10">10</option> #else <option value="10">10</option> #end
#if($dmi == 15) <option selected="selected" value="15">15</option> #else <option value="15">15</option> #end
#if($dmi == 20) <option selected="selected" value="20">20</option> #else <option value="20">20</option> #end
#if($dmi == 25) <option selected="selected" value="25">25</option> #else <option value="25">25</option> #end
#if($dmi == 30) <option selected="selected" value="30">30</option> #else <option value="30">30</option> #end 
#if($dmi == 35) <option selected="selected" value="35">35</option> #else <option value="35">35</option> #end
#if($dmi == 40) <option selected="selected" value="40">40</option> #else <option value="40">40</option> #end
#if($dmi == 45) <option selected="selected" value="45">45</option> #else <option value="45">45</option> #end
#if($dmi == 50) <option selected="selected" value="50">50</option> #else <option value="50">50</option> #end
#if($dmi == 55) <option selected="selected" value="55">55</option> #else <option value="55">55</option> #end
</select>
minutes
</td>
</tr>

<tr>
    <td class="chefLabel">End</td>
    <td>
     
    <select size="1" name="endHour" id="endHour" onchange="hourChange('endHour'); return false;">
      <option selected="selected" value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="11">11</option>
      <option value="12">12</option>
    </select>
    :
    <select size="1" name="endMinute" id="endMinute" onchange="hourChange('endMinute'); return false;">
        <option selected="selected" value="0">00</option>
        <option value="5">05</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="20">20</option>
        <option value="25">25</option>
        <option value="30">30</option>
        <option value="35">35</option>
        <option value="40">40</option>
        <option value="45">45</option>
        <option value="50">50</option>
        <option value="55">55</option>
    </select><select size="1" name="endAmpm" id="endAmpm" onchange="ampmChange('endAmpm'); return false;">
      <option selected="selected" value="am">am</option>
      <option value="pm">pm</option>
    </select></td>
</tr>

<tr> 
<td class="chefLabel">Frequency</td>
<td>
#if ($rule)
    Every $rule.Interval $freq(s)<br />
    #if (!($rule.Count == 0)) Number of occurrences: $rule.Count Times <br />#end
    #if ($rule.Until) Ends on $rule.Until.breakdownLocal().Month/$rule.Until.breakdownLocal().Day/$rule.Until.breakdownLocal().year <br />#end
#else
    #if ($freq) ## one occurrence doesn't have a 'freq' output
        #if ($event.RecurrenceRule)
            #set ($rule = $event.RecurrenceRule)
            Every $rule.Interval $freq(s)<br />
            #if (!($rule.Count == 0)) Number of occurrences: $rule.Count Times <br />#end
            #if ($rule.Until) Ends on $rule.Until.breakdownLocal().Month/$rule.Until.breakdownLocal().Day/$rule.Until.breakdownLocal().year <br />#end
        #end
    #else
        One occurrence
    #end
#end
<div class="chefButtonRow">
<input type="submit" name="eventSubmit_doEditfrequency" value="Set frequency..." />
</div>
</td>
</tr>

<tr>
    <td  class="chefLabel">Item type</td>
    <td>
    #if ($event.getType().length()!=0)
        #set($type = $event.getType())
    #else
        #set($type = "Activity")
    #end

    #if($savedData.getType().length() != 0)
        #set($type = $savedData.getType())
    #end

    <select name="eventType" onchange="blur()">
    #if ($type =="Academic Calendar") <option selected="selected">Academic Calendar</option> #else  <option>Academic Calendar</option>  #end
    #if ($type=="Activity") <option selected="selected">Activity</option>  #else <option>Activity</option>  #end
    #if ($type =="Cancellation") <option selected="selected">Cancellation</option>  #else  <option>Cancellation</option> #end
    #if ($type =="Class section - Discussion") <option selected="selected">Class section - Discussion </option>  #else <option>Class section - Discussion </option> #end
    #if ($type =="Class section - Lab") <option selected >Class section - Lab </option> #else <option>Class section - Lab </option> #end
    #if ($type =="Class section - Lecture") <option selected="selected">Class section - Lecture </option> #else <option>Class section - Lecture </option> #end
	#if ($type =="Class section - Small Group") <option selected="selected">Class section - Small Group </option> #else <option>Class section - Small Group </option> #end
	#if ($type =="Class session") <option selected="selected">Class session </option> #else <option>Class session </option> #end
	#if ($type =="Computer Session") <option selected="selected">Computer Session</option> #else <option>Computer Session</option> #end
	#if ($type =="Deadline") <option selected="selected">Deadline</option> #else <option>Deadline</option> #end
	#if ($type =="Exam") <option selected="selected">Exam</option> #else <option>Exam</option> #end
	#if ($type=="Meeting") <option selected="selected">Meeting</option> #else <option>Meeting</option> #end
    #if ($type=="Multidisciplinary Conference") <option selected="selected">Multidisciplinary Conference</option> #else  <option>Multidisciplinary Conference</option> #end
	#if ($type =="Quiz") <option selected="selected">Quiz</option> #else <option>Quiz</option> #end
	#if ($type =="Special event") <option selected="selected">Special event</option> #else <option>Special event</option> #end
	#if ($type =="Web Assignment") <option selected="selected">Web Assignment</option> #else <option>Web Assignment</option> #end
    </select>
    </td>
</tr>
<tr> 
  <td  class="chefLabel">Location</td>
  <td>
    #if ($savedData.Location.length() !=0)
        #set($str = $savedData.getLocation())
        <textarea name="location" wrap="virtual" rows="2" cols="60">$validator.escapeHtmlTextarea($str)</textarea>
    #elseif ($calEventFlag != "false")
        #if ($event.Location.length() != 0)
            #set($str = $event.Location)
            <textarea name="location" wrap="virtual" rows="2" cols="60">$validator.escapeHtmlTextarea($str)</textarea>
        #else
        <textarea name="location"  wrap="virtual" rows="2" cols="60"></textarea>
        #end
    #else
        <textarea name="location"  wrap="virtual" rows="2" cols="60"></textarea>
    #end
    </td>
</tr>

#foreach ($addfield in $addFieldsCalendarsCollection)
<tr> 
  <td class="chefLabel">$addfield</td>
  <td>
    #if ($savedData.getAddfieldValue($addfield).length() != 0)
        #set($afv = $savedData.getAddfieldValue($addfield))
        <textarea name="$addfield"  wrap="virtual" rows="2" cols="60">$validator.escapeHtmlTextarea($afv)</textarea>
    #elseif ($calEventFlag != "false")
        #if ($event.getField($addfield).length() != 0)
            #set($str = $event.getField($addfield))
            <textarea name="$addfield" wrap="virtual" rows="2" cols="60">$validator.escapeHtmlTextarea($str)</textarea>
        #else
        <textarea name="$addfield" wrap="virtual" rows="2" cols="60"></textarea>
        #end
    #else
        <textarea name="$addfield" wrap="virtual" rows="2" cols="60"></textarea>
    #end
  </td>
</tr>
#end
<tr>
<td class="chefLabel"></td>
<td>
    <fieldset class="chefAttachmentsF">
    <legend class="chefAttachmentsL">Attachments:</legend>
    #set ($size = 0)
    #if (!$attachments.isEmpty())
        #set ($props = false)
        #set ($size = $attachments.size())
        <ul class="chefAttachmentList">
        #foreach ($attachment in $attachments)
            #set ($props = $attachment.Properties)
            #if (!$props)
                #if ($size >0) #set ($size = $size - 1) #end
            #else
                #if ($props.getBooleanProperty($props.NamePropIsCollection))
                        <li><img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" />
                #else
                        <li><img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" />
                #end

                <a href="$attachment.Url" target="_new">$validator.escapeHtml($attachment.Properties.getPropertyFormatted("DAV:displayname"))</a>
                #if (!$props.getBooleanProperty($props.NamePropIsCollection))
                        ($props.getPropertyFormatted($props.NamePropContentLength))
                #end<br />
            #end
            </li>
            #set ($props = false)
        #end
        </ul>
    #end
    #if ($size == 0) No attachments ...
        <div class="chefButtonRow">
        <input type="submit" name="eventSubmit_doAttachments" value="Add attachments" />
        </div>
    #else
        <div class="chefButtonRow">
        <input type="submit" name="eventSubmit_doAttachments" value="Add/drop attachments" />
        </div>
    #end
    </fieldset>
</td>
</tr>
#if ($event.RecurrenceRule)
<tr>
	<td style="vertical-align:middle">&nbsp;</td>
	<td>
		<select name="intention">
                    #if ($savedData.IntentionStr.length() !=0)
                        #set($str = $savedData.IntentionStr)
			<option value="a" #if($str.equals("a"))selected="selected"#end>Modify all occurrences</option>
			<option value="t" #if($str.equals("t"))selected="selected"#end>Modify only this occurrence</option>
                    #else
                        <option value="a" selected="selected">Modify all occurrences</option>
			<option value="t">Modify only this occurrence</option>
                    #end		
		</select>
	</td>
</tr>
#end
</table>
</fieldset>
<div class="chefButtonRow">
    <input type="submit" name="eventSubmit_doUpdate" value="Post" />
    <input type="submit" name="eventSubmit_doCancel" value="Cancel" />
</div>
</form>

</div>
</div>