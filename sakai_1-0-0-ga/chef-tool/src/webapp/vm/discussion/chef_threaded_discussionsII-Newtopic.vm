## Zhen: when saving a draft reply I am returned to the item in edit mode (with a few errors). Should the behaviour not be the same as for topic?
<div class="chefPortletContainer">
	<div class="chefPortletContent">
		#if ($alertMessage)<div class="chefAlertBox">Alert: $validator.escapeHtml($alertMessage)</div>#end
		<script type="text/javascript">
			focus_path = [ "newcategory" ];
			if (parent) if (parent.parent) parent.parent.window.scrollTo(0,400);
		</script>
		<div class="chefPageviewTitle">
			Complete the form, then choose the appropriate button at the bottom. A <span class="chefRequiredInline">means</span> this information is required.
		</div>
		<form action="#toolForm($action)" method="post">
			<fieldset>
				<legend>
					Topic
				</legend>
				#set ($catCount =0)
				#foreach ($c in $categories)
					#set ($catCount = ($catCount + 1))
				#end
				<table class="chefEditItem" border ="0" summary="This table contains the information for a new topic">	
					#if ($catCount > 0)
						<tr>
							<td class ="chefRequiredInline">&nbsp;</td>
							<td class="chefLabel">
								Category: 
							</td>
							<td>
								<select name="category"  onchange="blur()">
									<option value="">-- Select a category --</option>
									#foreach ($c in $categories)
										#if ($c.equals($category))
											<option value="$validator.escapeHtml($c)" selected>$validator.escapeHtml($c)</option>
										#else
											<option value="$validator.escapeHtml($c)">$validator.escapeHtml($c)</option>
										#end
									#end
								</select>
							</td>	
						</tr>
						<tr>
							<td>
							</td>
							<td>
							</td>
							<td>
								or add a new category...<br />
								#if ($!newcategory)
									<input type="text" name="newcategory" id="newcategory" value="$validator.escapeHtml($category)" />
								#else
									<input type="text" name="newcategory" id="newcategory" value="" />
								#end
							</td>
						</tr>
					#else
						<tr>
							<td class ="chefRequiredInline">&nbsp;</td>
							<td class ="chefLabel">
								Category:
							 </td>
							 <td>
								#if ($!newcategory)
									<input type="text" name="newcategory" id="newcategory" value="$validator.escapeHtml($category)" />
								#else
									<input type="text" name="newcategory" id="newcategory" value="" />
								#end
							</td>
						</tr>
					#end	
					<tr>
						<td>&nbsp;</td>
						<td class="chefLabel">
							Date:
						</td>
						<td>
							$date.toStringLocalFull()
						</td>
					</tr>
					<tr>
					<td class ="chefRequiredInline">&nbsp;</td>
						<td class="chefLabel">
							Topic:
						</td>
						<td>
							<input type="text" size ="45" name="subject" value="$!newtopicsubject" />
						</td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td class="chefLabel">
							Reply type:
						</td>
						<td>
							#if ($!newtopicreplystyle.equals("star"))
								<input type="radio" name="style" value="thread" id="styleThread" /><label for="styleThread">Allow reply to any message</label></br />
								<input type="radio" name="style" value="star" id="styleStar" /><label for="styleStar">Allow reply to this topic only</label>
							#else
								<input type="radio" name="style" value="thread" checked="checked" id="styleThread" /><label for="styleThread">Allow reply to any message</label><br />
								<input type="radio" name="style" value="star" id="styleStar" /><label for="styleStar">Allow reply to this topic only</label>
							#end
						</td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td class="chefLabel">
							Message:
						</td>
						<td>
							<table border="0"><tr><td>
							<textarea name="body" id="body" cols="80" rows="15" wrap="virtual">$validator.escapeHtmlFormattedTextarea("$!newtopicbody")</textarea>
							#chef_setupformattedtextarea("body")
							</td></tr></table>
						</td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td>
							&nbsp;
						</td>
						<td>
							<fieldset class="chefAttachmentsF">
								<legend class="chefAttachmentsL">	
									Attachments
								</legend> 
								#set ($size = 0)
								#set ($props = false)
								#foreach ($attachment in $attachments) 
									#set ($props = $attachment.Properties) 
									#if ($!props)
										#set ($size = $size + 1)
									#end
								#end
								#if ($size == 0)
									No attachments ...
									<div class="chefButtonRow">
										<input type="submit" name="eventSubmit_doAttachments" value="Add attachments" />
									</div>
								#else
									<ul class="chefAttachmentList">
										#foreach ($attachment in $attachments) 
											#set ($props = false)
											#set ($props = $attachment.Properties) 
											#if ($!props)
												<li>
													#if ($props.getBooleanProperty($props.NamePropIsCollection))
														<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="folder attachment" />
													#else
														<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="File attachment" />
													#end
													<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
													#if (!$props.getBooleanProperty($props.NamePropIsCollection))
														($props.getPropertyFormatted($props.NamePropContentLength))
													#end
												</li>
											#end
										#end
									</ul>
									<div class="chefButtonRow">
										<input type="submit" name="eventSubmit_doAttachments" value="Add/remove attachments" />
									</div>
								#end							
							</fieldset>
						</td>
					</tr>
				</table>
			</fieldset>
			<div class="chefButtonRow">
				<input type="submit" name="eventSubmit_doNew_topic" value="Post" />
				<input type="submit" name="eventSubmit_doNew_topic" value="Save Draft" />
				<input type="submit" name="eventSubmit_doCancel_new_topic" value="Cancel" />
			</div>
		</form>
	</div>
</div>