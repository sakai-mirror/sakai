##<!-- $Header: /cvs/sakai2/legacy/tools/src/webapp/vm/discussion/chef_threaded_discussionsII-topic_content.vm,v 1.4 2005/05/26 19:54:18 zqian.umich.edu Exp $ -->
<div class="portletBody">
	<form name="formII" action="#toolForm("$action")" method="post" style="padding:0;display:inline">
		<p class="rightNav">
			#if ($!goPTButton)
				<input type="submit" name="eventSubmit_doPrev_topic_content" value="$tlang.getString("content.pretop")"/>
			#else
				<input type="submit" name="eventSubmit_doPrev_topic_content" value="$tlang.getString("content.pretop")" disabled="disabled"/>
			#end
			<input type="submit" name="eventSubmit_doCancel_show_topic_content" value="$tlang.getString("content.rettolis")"/>
			#if ($!goNTButton)
				<input type="submit" name="eventSubmit_doNext_topic_content" value="$tlang.getString("content.nextop")"/>
			#else
				<input type="submit" name="eventSubmit_doNext_topic_content" value="$tlang.getString("content.nextop")" disabled="disabled"/>
			#end
		</p>
	<h3>
		$tlang.getString("content.topcon")
	</h3>

	#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div style="display:block;clear:both" />#end
	<table rwidth="100%" border="0">
		<tr>	
			<td>
				#if ($topic.DiscussionHeader.Draft)
					<span class="highlight">$tlang.getString("gen.dra") </span>
				#end
				$validator.escapeHtml($topic.DiscussionHeader.Subject)
				#set($replyNumber = $topic.NumberOfReplies)
				#if ($replyNumber>0)
					#if ($replyNumber==1) 
						[ $tlang.getString("content.oneres") ]
					#else
						[$replyNumber $tlang.getString("content.morres")]
					#end
				#end
				- $validator.escapeHtml($topic.DiscussionHeader.From.DisplayName)
				($topic.DiscussionHeader.Date.toStringLocalFullZ())
			</td>
		</tr>
		<tr>
			<td style="padding-left:1em">
				$validator.escapeHtmlFormattedText($topic.Body)
			</td>
		</tr>
			#set ($size = 0)
			#set ($props = false)
			#foreach ($attachment in $topic.Header.Attachments) 
				#set ($props = $attachment.Properties) 
				#if ($!props)
					#set ($size = $size + 1)
				#end
			#end
			#if ($size != 0)
				<tr>
					<td>
						$tlang.getString("control.att2")
					</td>
				</tr>
				<tr>
					<td>
						<ul class="attachList">
							#foreach ($attachment in $topic.Header.Attachments) 
								#set ($props = false)
								#set ($props = $attachment.Properties) 
								#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("genl.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#if (!$props.getBooleanProperty($props.NamePropIsCollection))
											($props.getPropertyFormatted($props.NamePropContentLength))
										#end
									</li>
								#end
							#end
						</ul>
					</td>
				</tr>
			#end
	</table>
		#set($thread = $channel.getThread($topic))
		#foreach ($message in $thread)
		<table border ="0" style="margin-top:1em">
			<tr>
				<td nowrap="nowrap" style="letter-spacing:.3em">
					#set($depth = $message.ReplyToDepth)
					#foreach ($i in [1..$depth]) &nbsp; #end
				</td>
				<td>
					#if ($message.DiscussionHeader.Draft)
						<span class="highlight">$tlang.getString("gen.dra") </span>
					#end
					$validator.escapeHtml($message.DiscussionHeader.Subject)
					#set($replyNumber = $message.NumberOfReplies)
					#if ($replyNumber>0)
						#if ($replyNumber==1) 
							[$tlang.getString("content.oneres")]
						#else
							[$replyNumber $tlang.getString("content.morres")]
						#end
					#end
					 - $validator.escapeHtml($message.DiscussionHeader.From.DisplayName)
					($message.DiscussionHeader.Date.toStringLocalFullZ())
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td style="padding-left:1em">
						$validator.escapeHtmlFormattedText($message.Body)
				</td>
			</tr>
			#set ($size = 0)
			#set ($props = false)
			#foreach ($attachment in $message.Header.Attachments) 
				#set ($props = $attachment.Properties) 
				#if ($!props)
					#set ($size = $size + 1)
				#end
			#end
			#if ($size != 0)
				<tr>
					<td>
					</td>
					<td>
						$tlang.getString("control.att2")
						<br />
						<ul class="attachList">
							#foreach ($attachment in $message.Header.Attachments) 
								#set ($props = false)
								#set ($props = $attachment.Properties) 
								#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("genl.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#if (!$props.getBooleanProperty($props.NamePropIsCollection))
											($props.getPropertyFormatted($props.NamePropContentLength))
										#end
									</li>
								#end
							#end
						</ul>
					</td>
				</tr>	
			#end		
		</table>	
		#end
		<p class="rightNav" style="text-align:right;float:none">
			#if ($!goPTButton)
				<input type="submit" name="eventSubmit_doPrev_topic_content" value="$tlang.getString("content.pretop")"/>
			#else
				<input type="submit" name="eventSubmit_doPrev_topic_content" value="$tlang.getString("content.pretop")" disabled="disabled"/>
			#end
			<input type="submit" name="eventSubmit_doCancel_show_topic_content" value="$tlang.getString("content.rettolis")"/>
			#if ($!goNTButton)
				<input type="submit" name="eventSubmit_doNext_topic_content" value="$tlang.getString("content.nextop")"/>
			#else
				<input type="submit" name="eventSubmit_doNext_topic_content" value="$tlang.getString("content.nextop")" disabled="disabled"/>
			#end
		</p>
	</form>
</div>

