<!-- chef_resources_newlist.vm, version: $Revision:  $, use with org.sakaiproject.tool.content.ResourcesAction.java -->
<script language="JavaScript" type="text/JavaScript">
	<!--
		function openCopyrightWindow(theURL,winName,winSettings) 
		{ 
		  window.open(theURL,winName,winSettings);
		  return false;
		}
	//-->
</script>
<div class="portletBody">
	#set($itemsOnLine = 0)
	#if ($atHome && $atHome == $TRUE)
		#if($site.canRevise())
			<div class="chefToolBarWrapForm">
				#if(!$dropboxMode)
					#set($itemsOnLine = 1)
					<a href="#toolLink("ResourcesAction" "doShow_webdav")" title="$tlang.getString('dav.webdav')">$tlang.getString("dav.webdav").trim()</a> 
				#end 
				#if("$!inMyWorkspace" == "false")
					#if($itemsOnLine > 0)
						|
					#end
					<a href="#toolLink("ResourcesAction" "doPermissions")&collectionId=$validator.escapeUrl(${site.id})" title="$tlang.getString('list.sPerm')">$tlang.getString("list.sPerm").trim()</a>
				#end
			</div>
		#end
	#end
	#if ($alertMessage)
		<div class="chefAlertBox">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div style="display:block;clear:both" ></div>
	#end
	<form name="showForm" action="#toolForm("ResourcesAction")" method="post">
		<input type="hidden" name="source" value="0" />
		<input type="hidden" name="collectionId" value="$validator.escapeHtml($collectionId)" />
		<input type="hidden" name="from" value="list" />
		######################  Page Title / Breadcrumbs  ##############
		<h3>
			<!-- collectionPath == $collectionPath -->
			<span class ="chefBreadCrumb">
				$tlang.getString("gen.location")
				<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" />
				#foreach ($item in $collectionPath)
					<!-- $item.name -->
					#if($item.isLast())
						#if ($dropboxMode && $velocityCount == 1)
							$siteTitle $tlang.getString("gen.drop")
						#elseif($velocityCount == 1)
							$siteTitle $tlang.getString("gen.reso")
						#else
							$validator.escapeHtml("$item.name")
						#end
						#if($upOneLevel)
							<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=$validator.escapeUrl($upOneLevel.id)&navRoot=$validator.escapeUrl($upOneLevel.root)" title= "$tlang.getString('sh.one')">
								<img src="/library/image/sakai/onelevelup.gif" border="0" alt ="$tlang.getString('sh.one')"/>
							</a>
						#end
					#else
						<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=$validator.escapeUrl($item.id)&navRoot=$validator.escapeUrl($item.root)" title ="$tlang.getString('sh.go')">
							#if ($dropboxMode && $velocityCount == 1)
								$siteTitle $tlang.getString("gen.drop")
							#elseif($velocityCount == 1)
								$siteTitle $tlang.getString("gen.reso")
							#else
								$validator.escapeHtml("$item.name")
							#end
						</a> /
						#set($upOneLevel = $item)
					#end
				#end
			</span>		
		</h3>
		######################  Heirarchical list of resource folders/items  ##############
		<table class="listHier speciallistHier" cellspacing="0" border="0">
			######################  Column labels, sort controls, expand/collapse all  ##############
			<tr>
				<th id="title">
					#if ($expandallflag && "$expandallflag" == "$TRUE")
						<a href="#toolLink("ResourcesAction" "doUnexpandall")&collectionId=$validator.escapeUrl($collectionId)" title ="$tlang.getString('collapseall')">
							<img src = "#imageLink("sakai/collapse.gif")" border="0" title="$tlang.getString('collapseall')" alt="$tlang.getString('collapseall')" hspace="0" />
						</a>								 
					#else
						<a href="#toolLink("ResourcesAction" "doExpandall")&collectionId=$validator.escapeUrl($collectionId)" title ="$tlang.getString('expandall')">
							<img src = "#imageLink("sakai/expand.gif")" border="0" title="$tlang.getString('expandall')" alt="$tlang.getString('expandall')" hspace="0" />
						</a>								 
					#end
##					<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="%%%" />
					<a href="#toolLink("ResourcesAction" "doSort")&criteria=title&collectionId=$validator.escapeUrl($collectionId)" title ="$tlang.getString('sh.sorttit')"> 
						$tlang.getString("gen.title1")
						#if ($currentSortedBy.equals($resourceProperties.NamePropDisplayName)) 
							#if ($currentSortAsc.equals("true")) 
								<img src = "#imageLink("sakai/sortascending.gif")" border="0" title ="$tlang.getString('sh.sorttitas')" alt ="$tlang.getString('sh.sorttitas')" /> 
							#else 
								<img src = "#imageLink("sakai/sortdescending.gif")" border="0" title ="$tlang.getString('sh.sorttitdesc')" alt ="$tlang.getString('sh.sorttitdesc')" /> 
							#end 
						#end 
					</a>
				</th>
				<th id="actions">
					$tlang.getString("gen.actions")
				</th>
				<th id="modified">
					<a href="#toolLink("ResourcesAction" "doSort")&criteria=last%20modified&collectionId=$validator.escapeUrl($collectionId)" title ="$tlang.getString('sh.sortdate')"> 
						$tlang.getString("gen.last1")
						#if ($currentSortedBy.equals($resourceProperties.NamePropModifiedDate)) 
							#if ($currentSortAsc.equals("true")) 
								<img src = "#imageLink("sakai/sortascending.gif")" border="0"  title ="$tlang.getString('sh.sortdateas')"  alt ="$tlang.getString('sh.sortdateas')" /> 
							#else 
								<img src = "#imageLink("sakai/sortdescending.gif")" border="0" title ="$tlang.getString('sh.sortdatedesc')"  alt ="$tlang.getString('sh.sortdatedesc')" /> 
							#end 
						#end 
					</a>
				</th>
				##<th>
				##why this empty column?
				## &nbsp;
				##</th>
			</tr>
			#foreach($root in $roots)
				############################### Show top level folder #################
				<!-- $root.name -->
				<tr>
					<td headers="title">
						#if ($root.isFolder())
							#if ($root.isEmpty())
								<span style="width:13px;"></span>
							#else
								#if (!$expandedCollections.containsKey($root.Id))
									#if ($root.canRead())
										<a href="#toolLink("ResourcesAction" "doExpand_collection")&collectionId=$validator.escapeUrl($root.Id)" title="$tlang.getString('sh.open')">
											<img src = "#imageLink("sakai/expand.gif")" border="0" title="$tlang.getString('sh.open')" alt="$tlang.getString('sh.closed')" hspace="0" />
										</a>
									#else
										<img src = "#imageLink("sakai/expand.gif")" border="0" alt = "$tlang.getString('sh.closed')" hspace="0" />
									#end
								#else
									<a href="#toolLink("ResourcesAction" "doCollapse_collection")&collectionId=$validator.escapeUrl($root.Id)" title="$tlang.getString('sh.close')">
										<img src = "#imageLink("sakai/collapse.gif")" border="0" title="$tlang.getString('sh.close')" alt="$tlang.getString('sh.opened')" hspace="0" />
									</a>
								#end
							#end
						#end					
						#if($root.isLocal())
							#if ($dropboxMode && $collectionPath.size() <= 1)
								$siteTitle $tlang.getString("gen.drop")
							#elseif($collectionPath.size() <= 1)
								$siteTitle $tlang.getString("gen.reso")
							#elseif($root)
								$validator.escapeHtml("$root.name")
							#elseif ($dropboxMode)
								$siteTitle $tlang.getString("gen.drop")
							#else
								$siteTitle $tlang.getString("gen.reso")
							#end
						#elseif ($root.canRead())
							#if (!$expandedCollections.containsKey($root.Id))
								<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=${validator.escapeUrl(${root.id})}&navRoot=${validator.escapeUrl(${root.root})}">
									<img src = "#imageLink("sakai/dir_closed.gif")" border="0" title="$tlang.getString('sh.go')" alt="$tlang.getString('sh.go')" />
								</a>
							#else
								<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=${validator.escapeUrl(${root.id})}&navRoot=${validator.escapeUrl(${root.root})}">
									<img src = "#imageLink("sakai/dir_open.gif")" border="0" title="$tlang.getString('sh.go')" alt="$tlang.getString('sh.go')" />
								</a>
							#end	
							<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=${validator.escapeUrl(${root.id})}&navRoot=${validator.escapeUrl(${root.root})}" title="$tlang.getString('sh.go')">
								$validator.escapeHtml(${root.name})
							</a>
						#else
							$validator.escapeHtml(${root.name})
						#end	
					</td>
					<td headers="actions">
						######################  Add Action Links at Top Level  ##############
						#if($root && ($root.canAddItem() || $root.canAddFolder()))
							<div class="itemAction">
								#set ($itemsOnLine = 0)
								####### deal with Pasting copied items 
								#if($copyFlag && $copyFlag.equals($TRUE) && $root.canAddItem())
									#if ($itemsOnLine > 0)
										|
									#end
									#set ($itemsOnLine = $itemsOnLine + 1)
									<a href="#toolLink("ResourcesAction" "doPasteitem")&itemId=${validator.escapeUrl($copiedItem)}&collectionId=${validator.escapeUrl(${root.id})}" title="$tlang.getString('list.paste1')">$tlang.getString("list.paste1").trim()</a>
								#end
								####### deal with editing/viewing file/folder information
								#if ($atHome && !$atHome == $TRUE)
									#if($root.canRevise())
										#if ($itemsOnLine > 0)
											|
										#end
										#set ($itemsOnLine = $itemsOnLine + 1)
										<a href="#toolLink("ResourcesAction" "doEdit")&from=list&id=$validator.escapeUrl($root.id)&collectionId=$validator.escapeUrl($root.container)" title="$tlang.getString('list.edit')">$tlang.getString("list.edit").trim()</a>
									#elseif ($root.canRead())
										#if ($itemsOnLine > 0)
											|
										#end
										#set ($itemsOnLine = $itemsOnLine + 1)
										<a href="#toolLink("ResourcesAction" "doMore")&from=list&id=$validator.escapeUrl($root.id)&collectionId=$validator.escapeUrl($root.container)" title="$tlang.getString('list.props')">$tlang.getString("list.props").trim()</a>
									#end
								#end
								####### deal with adding folder
								#if($root.canAddFolder())
									#if ($itemsOnLine > 0)
										|
									#end
									#set ($itemsOnLine = $itemsOnLine + 1)
									<a href="#toolLink("ResourcesAction" "doCreate")&itemType=${TYPE_FOLDER}&collectionId=$validator.escapeUrl(${root.id})" title ="$tlang.getString('list.folder')">$tlang.getString("list.folder").trim()</a>
								#end
								####### deal with adding item
								#if($root.canAddItem())
									#if ($itemsOnLine > 0)
										|
									#end
									#set ($itemsOnLine = $itemsOnLine + 1)
									<a href="#toolLink("ResourcesAction" "doCreate")&itemType=${TYPE_UPLOAD}&collectionId=$validator.escapeUrl(${root.id})" title ="$tlang.getString('list.item')">$tlang.getString("list.item").trim()</a>
								#end
								####### deal with site/folder permissions
								#if($root.canRevise() && "$!inMyWorkspace" == "false")
									#if (!$atHome || ($atHome && $atHome != $TRUE))
										#if ($itemsOnLine > 0)
											|
										#end
										#set ($itemsOnLine = $itemsOnLine + 1)
										<a href="#toolLink("ResourcesAction" "doFolder_permissions")&collectionId=$validator.escapeUrl(${root.id})" title="$tlang.getString('list.fPerm')">$tlang.getString("list.fPerm").trim()</a>
									#end
								#end
							</div>
						#end
						######################  End of Add Items/Folders at Top Level  ##############
					</td>
				</tr>	
				#set($collectionMembers = $root.Members)
				######################  No items message  ##############
				#if ($root.isLocal() && $collectionMembers.isEmpty())
					<tr>
						<td  colspan="4">
							<p class="instruction">
								$tlang.getString("sh.no")
								#if($dropboxMode)$tlang.getString("sh.drop")#else$tlang.getString("sh.reso")#end
								$tlang.getString("sh.item")
							</p>
						</td>
					</tr>		
				#else
					######################  Display individual items/folders  ##############
					#set ($unit ="em")
					#foreach ($member in $collectionMembers)
						<!-- $member.name -->
						#set ($width = "$!{member.depth}$unit")
						#set ($widthSp = (${member.depth} + 1) )
						#set ($widthSpDo = "$widthSp$unit")
						#if ($member.depth==1)	
							#set ($margin="margin-left:0")
						#else
							#set ($margin="margin-left:2em")
							#set ($marginAction="margin-left:4.7em")
						#end
						<tr>
							######################  Item title and action links  ##############
							<td headers="title" style="text-indent:$width">
								#if ($member.isFolder())
									#if ($member.isEmpty())
										<span style="width:13px;"></span>
									#else
										#if (!$expandedCollections.containsKey($member.Id))
											#if ($member.canRead())
												<a href="#toolLink("ResourcesAction" "doExpand_collection")&collectionId=$validator.escapeUrl($member.Id)" title="$tlang.getString('sh.open')">
													<img src = "#imageLink("sakai/expand.gif")" border="0" title="$tlang.getString('sh.open')" alt="$tlang.getString('sh.closed')" hspace="0" />
												</a>
											#else
												<img src = "#imageLink("sakai/expand.gif")" border="0" alt = "$tlang.getString('sh.closed')" hspace="0" />
											#end
										#else
											<a href="#toolLink("ResourcesAction" "doCollapse_collection")&collectionId=$validator.escapeUrl($member.Id)" title="$tlang.getString('sh.close')">
												<img src = "#imageLink("sakai/collapse.gif")" border="0" title="$tlang.getString('sh.close')" alt="$tlang.getString('sh.opened')" hspace="0" />
											</a>
										#end
									#end
								#else
									#if ($member.canRead())
										#if ($member.hasCopyrightAlert())
											## if there is a copyright alert, show the alert page first
											<a href="" onclick="openCopyrightWindow('${member.url}&copyrightAlert','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false">
											#else
											<a href="${member.url}" target="${member.target}">
										#end
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage($member.type))" border= "0" alt ="" hspace="0" />
										</a>
									#else
										 <img src = "#imageLink($contentTypeImageService.getContentTypeImage($member.type))" border="0" alt ="" hspace="0" />
									#end
								#end
								#if ($member.isFolder())
									#if ($member.canRead())
										#if (!$expandedCollections.containsKey($member.Id))
											<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=${validator.escapeUrl(${member.id})}&navRoot=${validator.escapeUrl(${member.root})}">
												<img src = "#imageLink("sakai/dir_closed.gif")" border="0" title="$tlang.getString('sh.go')" alt="$tlang.getString('sh.go')" />
											</a>
										#else
											<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=${validator.escapeUrl(${member.id})}&navRoot=${validator.escapeUrl(${member.root})}">
												<img src = "#imageLink("sakai/dir_open.gif")" border="0" title="$tlang.getString('sh.go')" alt="$tlang.getString('sh.go')" />
											</a>
										#end	
										<a href="#toolLink("ResourcesAction" "doNavigate")&collectionId=${validator.escapeUrl(${member.id})}&navRoot=${validator.escapeUrl(${member.root})}" title="$tlang.getString('sh.go')">
											$validator.escapeHtml(${member.name})
										</a>
									#else
										$validator.escapeHtml(${member.name})
									#end
								#else
									#if ($member.canRead())
										#if ($member.hasCopyrightAlert())
											## if there is a copyright alert, show the alert page first
											<a href="" onclick="openCopyrightWindow('${member.url}&copyrightAlert','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false;">
												$validator.escapeHtml($member.name)
											</a>
											&#169;
										#else
											<a href="$member.url" target="$member.target">
												$validator.escapeHtml($member.name)
											</a>
										#end
									#else
										$validator.escapeHtml($member.name)
										#if ($member.hasCopyrightAlert())
											&#169;
										#end
									#end
								#end
							</td>
							<td headers="actions">
								<div class="itemAction">
									#if($member.isFolder())
										#set ($itemsOnLine = 0)
										####### deal with Pasting copied items  3
										#if($copyFlag && $copyFlag.equals($TRUE) && $member.canAddItem())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doPasteitem")&itemId=${validator.escapeUrl($copiedItem)}&collectionId=${validator.escapeUrl(${member.id})}" title="$tlang.getString('list.paste1')">$tlang.getString("list.paste1").trim()</a>
										#end
										####### deal with viewing file/folder information
										#if ($member.canRead())
										#if ($itemsOnLine > 0)
											|
										#end
										#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doMore")&from=list&id=$validator.escapeUrl($member.id)&collectionId=$validator.escapeUrl($member.container)" title="$tlang.getString('list.props')">$tlang.getString("list.props").trim()</a>
										#end
										####### deal with editing file/folder information
										#if ($member.canRevise())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doEdit")&from=list&id=$validator.escapeUrl($member.id)&collectionId=$validator.escapeUrl($member.container)" title="$tlang.getString('list.edit')">$tlang.getString("list.edit").trim()</a>
										#end
										####### deal with deleting folder
										#if ($member.canDelete())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doDeleteconfirm")&from=list&selectedMembers=$validator.escapeUrl($member.id)" title="$tlang.getString('list.del')">$tlang.getString("list.del").trim()</a>
										#end								
										####### deal with adding folder
										#if($member.canAddFolder())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doCreate")&itemType=${TYPE_FOLDER}&collectionId=$validator.escapeUrl(${member.id})" title ="$tlang.getString('list.folder')">$tlang.getString("list.folder").trim()</a>
										#end
										####### deal with folder permissions
										#if($member.canRevise() && "$!inMyWorkspace" == "false")
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doFolder_permissions")&collectionId=$validator.escapeUrl(${member.id})" title="$tlang.getString('list.fPerm')">$tlang.getString("list.fPerm").trim()</a>
										#end
										####### deal with adding item
										#if($member.canAddItem())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doCreate")&itemType=${TYPE_UPLOAD}&collectionId=$validator.escapeUrl(${member.id})" title="$tlang.getString('list.item')">$tlang.getString("list.item").trim()</a>
										#end
									#else
										#set ($itemsOnLine = 0)
										####### deal with editing/viewing file/folder information
										#if ($member.canRevise())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doEdit")&from=list&id=$validator.escapeUrl($member.id)&collectionId=$validator.escapeUrl($member.container)" title="$tlang.getString('list.edit')">$tlang.getString("list.edit").trim()</a>
										#elseif ($member.canRead())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doMore")&from=list&id=$validator.escapeUrl($member.id)&collectionId=$validator.escapeUrl($member.container)" title="$tlang.getString('list.props')">$tlang.getString("list.props").trim()</a>
										#end
										####### deal with copying item
										#if ($paste_place_showing && $member.canRead())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doCopyitem")&itemId=$validator.escapeUrl(${member.id})" title ="$tlang.getString('list.copy')">$tlang.getString("list.copy").trim()</a>
										#end
										####### deal with deleting item
										#if ($member.canDelete())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doDeleteconfirm")&from=list&selectedMembers=$validator.escapeUrl($member.id)" title="$tlang.getString('list.del')">$tlang.getString("list.del").trim()</a>
										#end								
			
										####### deal with duplicating item
										#if($member.canRead() && $member.canAddItem())
											#if ($itemsOnLine > 0)
												|
											#end
											#set ($itemsOnLine = $itemsOnLine + 1)
											<a href="#toolLink("ResourcesAction" "doPasteitem")&itemId=${validator.escapeUrl(${member.id})}&collectionId=${validator.escapeUrl(${member.container})}" title="$tlang.getString('list.dup')">$tlang.getString("list.dup").trim()</a>
										#end
									#end
								</div>
								#if($copyFlag && "${member.id}" == "$copiedItem")
									<div class="inlineAlert">
										$tlang.getString("list.copied")
									</div>
								#end
							</td>
							######################  Item/folder modification date  ##############
							<td headers="modified">
								$member.ModifiedTime
							</td>
						</tr>
					#end
				#end
			#end ## foreach $root in $roots
		</table>
	</form>						
</div>
