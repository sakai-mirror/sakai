##<!-- $Header: /cvs/sakai/chef-tool/src/webapp/vm/sitebrowser/chef_sitebrowser_visit.vm,v 1.6 2005/02/02 03:01:23 janderse.umich.edu Exp $ -->
##<script type="text/javascript" language="JavaScript">
## focus_path = [#if(!$site)"id"#else"title"#end];
##</script>

<div class="portletBody">

	#if($menu)
		#toolbar($menu)
	#end
	
	<form action="#toolForm("$action")" method="post">	
	<p class="nav">
	#if ($goPrevButton == "true")
	<input type="submit" name="eventSubmit_doView_prev" value="< Previous" />
	#end
	<input type="submit" name="eventSubmit_doBack" value="Return to List" />
	#if ($goNextButton == "true")
	<input type="submit" name="eventSubmit_doView_next" value="Next >" />
	#end
	</p>
	</form>
	
	<h3 class="insColor insBak insBor">$validator.escapeHtml($site.Title)</h3>
	#if ($infoUrl)
				<iframe style="display:block;clear:both" 
					width="100%"
					#if ($height) height="$height" #end
					frameborder="0"
					marginwidth="0"
					marginheight="0"
					scrolling="auto"
					align="middle"
					src="$infoUrl">
				</iframe>
	#end
	#set ($sdesc = $site.Description)
	#if ($sdesc && ($sdesc.length() > 0))
		<p class="indnt1">$validator.escapeHtml($sdesc)</p>
	#end
	<h4 class="insColor insBak insBor indnt1">Public Announcements</h4>
	#if ($announcements.size() > 0)
		<table class="itemSummary indnt2" cellspacing="0" cellpadding="0" border="0">
			#foreach ($message in $announcements)
				<tr>
					<th>Subject</th>
					<td>$validator.escapeHtml($message.Header.subject)</td> 
				</tr>
				<tr>
					<th>From</th>
					<td>$validator.escapeHtml($message.Header.From.DisplayName) ($message.Header.Date.toStringLocalFull())</td>
				</tr>
				<tr>
					<th>Message</th>
					<td>$validator.escapeHtmlFormattedText($message.body)</td>
				</tr>
				
				#if (!$message.Header.Attachments.isEmpty())
				<tr>
					<th>Attachments</th>
					#set ($props = false)
					<td>
					<ul class="attachList">
						#foreach ($attachment in $message.Header.Attachments)
							#set ($props = $attachment.Properties)
							#if ($props)
								<li>
									#if ($props.getBooleanProperty($props.NamePropIsCollection))
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="folder" />
									#else
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="" />
									#end
										<a href="$attachment.Url" target="_blank">
											$validator.escapeHtml($attachment.Properties.getPropertyFormatted("DAV:displayname"))
										</a>
									#if (!$props.getBooleanProperty($props.NamePropIsCollection))
															($props.getPropertyFormatted($props.NamePropContentLength))
									#end
								</li>
							#end
						#end
					</ul>
					</td>	
				</tr>
				#end
			#end
		</table>
	#else
		<p class="indnt2">There are no public annoucements for this site.</p>
	#end
	
	<h4 class="insColor insBak insBor indnt1">Public Resources</h4>
	#if ($resources.size() > 0)
		<table class="itemSummary indnt2" cellspacing="0" cellpadding="0" border="0">
		#foreach ($rsrc in $resources)
			#set ($properties = $rsrc.Properties)
			<tr>
				<th>Title</th>
				<td>
					<a href="$rsrc.Url" target="_blank">
					#if ($properties.getBooleanProperty($properties.NamePropIsCollection))
						<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt ="folder" />
					#else
						<img src = "#imageLink($contentTypeImageService.getContentTypeImage($properties.getProperty($properties.NamePropContentType)))" border="0" alt ="" />
					#end
						$validator.escapeHtml($properties.getPropertyFormatted($properties.NamePropDisplayName))
				</td>
			</tr>
			<tr>
				<th>&nbsp;</th>
				<td>
				$validator.escapeHtml($properties.getPropertyFormatted($properties.NamePropCreator))  ($properties.getPropertyFormatted($properties.NamePropCreationDate)). 
				&nbsp; Size:  $properties.getPropertyFormatted($properties.NamePropContentLength).  
				</td>
			</tr>
			#set ($desc = $properties.getPropertyFormatted($properties.NamePropDescription))
			#if ($desc && ($desc.length() > 0))
				<tr>
					<th>Description</th>
					<td>$validator.escapeHtml($desc)
				</td>
				</tr>
			#end
				
		#end
		</table>
	#else
		<p class="indnt2">There are no public resources for this site.</p>
	#end
	<form action="#toolForm("$action")" method="post">	
	<p class="nav">
	#if ($goPrevButton == "true")
	<input type="submit" name="eventSubmit_doView_prev" value="< Previous" />
	#end
	<input type="submit" name="eventSubmit_doBack" value="Return to List" />
	#if ($goNextButton == "true")
	<input type="submit" name="eventSubmit_doView_next" value="Next >" />
	#end
	</p>
	</form>

</div>
